"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[51480],{51480:function(e,t,r){r.r(t),r.d(t,{Dropcursor:function(){return V},default:function(){return V}});var n=r(63342),o=r(59084),s=r(16560);const i=Object.create(null);class l{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new a(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=o.p2.empty){let r=t.content.lastChild,n=null;for(let e=0;e<t.openEnd;e++)n=r,r=r.lastChild;let s=e.steps.length,i=this.ranges;for(let l=0;l<i.length;l++){let{$from:a,$to:h}=i[l],c=e.mapping.slice(s);e.replaceRange(c.map(a.pos),c.map(h.pos),l?o.p2.empty:t),0==l&&y(e,s,(r?r.isInline:n&&n.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,n=this.ranges;for(let o=0;o<n.length;o++){let{$from:s,$to:i}=n[o],l=e.mapping.slice(r),a=l.map(s.pos),h=l.map(i.pos);o?e.deleteRange(a,h):(e.replaceRangeWith(a,h,t),y(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let n=e.parent.inlineContent?new d(e):w(e.node(0),e.parent,e.pos,e.index(),t,r);if(n)return n;for(let n=e.depth-1;n>=0;n--){let o=t<0?w(e.node(0),e.node(n),e.before(n+1),e.index(n),t,r):w(e.node(0),e.node(n),e.after(n+1),e.index(n)+1,t,r);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new m(e.node(0))}static atStart(e){return w(e,e,0,0,1)||new m(e)}static atEnd(e){return w(e,e,e.content.size,e.childCount,-1)||new m(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=i[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in i)throw new RangeError("Duplicate use of selection JSON ID "+e);return i[e]=t,t.prototype.jsonID=e,t}getBookmark(){return d.between(this.$anchor,this.$head).getBookmark()}}l.prototype.visible=!0;class a{constructor(e,t){this.$from=e,this.$to=t}}let h=!1;function c(e){h||e.parent.inlineContent||(h=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class d extends l{constructor(e,t=e){c(e),c(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return l.near(r);let n=e.resolve(t.map(this.anchor));return new d(n.parent.inlineContent?n:r,r)}replace(e,t=o.p2.empty){if(super.replace(e,t),t==o.p2.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof d&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new u(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new d(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let n=e.resolve(t);return new this(n,r==t?n:e.resolve(r))}static between(e,t,r){let n=e.pos-t.pos;if(r&&!n||(r=n>=0?1:-1),!t.parent.inlineContent){let e=l.findFrom(t,r,!0)||l.findFrom(t,-r,!0);if(!e)return l.near(t,r);t=e.$head}return e.parent.inlineContent||(0==n||(e=(l.findFrom(e,-r,!0)||l.findFrom(e,r,!0)).$anchor).pos<t.pos!=n<0)&&(e=t),new d(e,t)}}l.jsonID("text",d);class u{constructor(e,t){this.anchor=e,this.head=t}map(e){return new u(e.map(this.anchor),e.map(this.head))}resolve(e){return d.between(e.resolve(this.anchor),e.resolve(this.head))}}class p extends l{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:n}=t.mapResult(this.anchor),o=e.resolve(n);return r?l.near(o):new p(o)}content(){return new o.p2(o.HY.from(this.node),0,0)}eq(e){return e instanceof p&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new f(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new p(e.resolve(t.anchor))}static create(e,t){return new p(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}p.prototype.visible=!1,l.jsonID("node",p);class f{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new u(r,r):new f(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&p.isSelectable(r)?new p(t):l.near(t)}}class m extends l{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=o.p2.empty){if(t==o.p2.empty){e.delete(0,e.doc.content.size);let t=l.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new m(e)}map(e){return new m(e)}eq(e){return e instanceof m}getBookmark(){return g}}l.jsonID("all",m);const g={map(){return this},resolve(e){return new m(e)}};function w(e,t,r,n,o,s=!1){if(t.inlineContent)return d.create(e,r);for(let i=n-(o>0?0:1);o>0?i<t.childCount:i>=0;i+=o){let n=t.child(i);if(n.isAtom){if(!s&&p.isSelectable(n))return p.create(e,r-(o<0?n.nodeSize:0))}else{let t=w(e,n,r+o,o<0?n.childCount:0,o,s);if(t)return t}r+=n.nodeSize*o}return null}function y(e,t,r){let n=e.steps.length-1;if(n<t)return;let o,i=e.steps[n];(i instanceof s.Pu||i instanceof s.FC)&&(e.mapping.maps[n].forEach(((e,t,r,n)=>{null==o&&(o=n)})),e.setSelection(l.near(e.doc.resolve(o),r)))}function v(e,t){return t&&e?e.bind(t):e}class b{constructor(e,t,r){this.name=e,this.init=v(t.init,r),this.apply=v(t.apply,r)}}new b("doc",{init(e){return e.doc||e.schema.topNodeType.createAndFill()},apply(e){return e.doc}}),new b("selection",{init(e,t){return e.selection||l.atStart(t.doc)},apply(e){return e.selection}}),new b("storedMarks",{init(e){return e.storedMarks||null},apply(e,t,r,n){return n.selection.$cursor?e.storedMarks:null}}),new b("scrollToSelection",{init(){return 0},apply(e,t){return e.scrolledIntoView?t+1:t}});function $(e,t,r){for(let n in e){let o=e[n];o instanceof Function?o=o.bind(t):"handleDOMEvents"==n&&(o=$(o,t,{})),r[n]=o}return r}class C{constructor(e){this.spec=e,this.props={},e.props&&$(e.props,this,this.props),this.key=e.key?e.key.key:k("plugin")}getState(e){return e[this.key]}}const S=Object.create(null);function k(e){return e in S?e+"$"+ ++S[e]:(S[e]=0,e+"$")}function O(e={}){return new C({view(t){return new x(t,e)}})}class x{constructor(e,t){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let r=e=>{this[t](e)};return e.dom.addEventListener(t,r),{name:t,handler:r}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos);if(!t.parent.inlineContent){let r=t.nodeBefore,n=t.nodeAfter;if(r||n){let t=this.editorView.nodeDOM(this.cursorPos-(r?r.nodeSize:0));if(t){let o=t.getBoundingClientRect(),s=r?o.bottom:o.top;r&&n&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:o.left,right:o.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let r,n,o=this.editorView.dom.offsetParent;if(this.element||(this.element=o.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),!o||o==document.body&&"static"==getComputedStyle(o).position)r=-pageXOffset,n=-pageYOffset;else{let e=o.getBoundingClientRect();r=e.left-o.scrollLeft,n=e.top-o.scrollTop}this.element.style.left=e.left-r+"px",this.element.style.top=e.top-n+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),n=r&&r.type.spec.disableDropCursor,o="function"==typeof n?n(this.editorView,t,e):n;if(t&&!o){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(e=(0,s.nj)(this.editorView.state.doc,e,this.editorView.dragging.slice),null==e))return this.setCursor(null);this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const V=n.Extension.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[O(this.options)]}})}}]);
//# sourceMappingURL=51480.6821dea40ab51567a3dc.min.js.map