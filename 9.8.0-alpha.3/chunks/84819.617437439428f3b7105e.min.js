"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[84819],{84819:function(e,t,n){n.r(t),n.d(t,{History:function(){return V},default:function(){return V}});var r=n(63342),o=200,i=function(){};i.prototype.append=function(e){return e.length?(e=i.from(e),!this.length&&e||e.length<o&&this.leafAppend(e)||this.length<o&&e.leafPrepend(this)||this.appendInner(e)):this},i.prototype.prepend=function(e){return e.length?i.from(e).append(this):this},i.prototype.appendInner=function(e){return new a(this,e)},i.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?i.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},i.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},i.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},i.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(t,n){return r.push(e(t,n))}),t,n),r},i.from=function(e){return e instanceof i?e:e&&e.length?new s(e):i.empty};var s=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,r){for(var o=t;o<n;o++)if(!1===e(this.values[o],r+o))return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){for(var o=t-1;o>=n;o--)if(!1===e(this.values[o],r+o))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=o)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=o)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(i);i.empty=new s([]);var a=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,r){var o=this.left.length;return!(t<o&&!1===this.left.forEachInner(e,t,Math.min(n,o),r))&&(!(n>o&&!1===this.right.forEachInner(e,Math.max(t-o,0),Math.min(this.length,n)-o,r+o))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,r){var o=this.left.length;return!(t>o&&!1===this.right.forEachInvertedInner(e,t-o,Math.max(n,o)-o,r+o))&&(!(n<o&&!1===this.left.forEachInvertedInner(e,Math.min(t,o),n,r))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(i),p=i,l=n(16560),h=n(59084);const c=Object.create(null);class u{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new f(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=h.p2.empty){let n=t.content.lastChild,r=null;for(let e=0;e<t.openEnd;e++)r=n,n=n.lastChild;let o=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:a,$to:p}=i[s],l=e.mapping.slice(o);e.replaceRange(l.map(a.pos),l.map(p.pos),s?h.p2.empty:t),0==s&&b(e,o,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:i,$to:s}=r[o],a=e.mapping.slice(n),p=a.map(i.pos),l=a.map(s.pos);o?e.deleteRange(p,l):(e.replaceRangeWith(p,l,t),b(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new g(e):S(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let o=t<0?S(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):S(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new M(e.node(0))}static atStart(e){return S(e,e,0,0,1)||new M(e)}static atEnd(e){return S(e,e,e.content.size,e.childCount,-1)||new M(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=c[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in c)throw new RangeError("Duplicate use of selection JSON ID "+e);return c[e]=t,t.prototype.jsonID=e,t}getBookmark(){return g.between(this.$anchor,this.$head).getBookmark()}}u.prototype.visible=!0;class f{constructor(e,t){this.$from=e,this.$to=t}}let d=!1;function m(e){d||e.parent.inlineContent||(d=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class g extends u{constructor(e,t=e){m(e),m(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return u.near(n);let r=e.resolve(t.map(this.anchor));return new g(r.parent.inlineContent?r:n,n)}replace(e,t=h.p2.empty){if(super.replace(e,t),t==h.p2.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof g&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new v(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new g(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if(n&&!r||(n=r>=0?1:-1),!t.parent.inlineContent){let e=u.findFrom(t,n,!0)||u.findFrom(t,-n,!0);if(!e)return u.near(t,n);t=e.$head}return e.parent.inlineContent||(0==r||(e=(u.findFrom(e,-n,!0)||u.findFrom(e,n,!0)).$anchor).pos<t.pos!=r<0)&&(e=t),new g(e,t)}}u.jsonID("text",g);class v{constructor(e,t){this.anchor=e,this.head=t}map(e){return new v(e.map(this.anchor),e.map(this.head))}resolve(e){return g.between(e.resolve(this.anchor),e.resolve(this.head))}}class y extends u{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),o=e.resolve(r);return n?u.near(o):new y(o)}content(){return new h.p2(h.HY.from(this.node),0,0)}eq(e){return e instanceof y&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new w(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new y(e.resolve(t.anchor))}static create(e,t){return new y(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}y.prototype.visible=!1,u.jsonID("node",y);class w{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new v(n,n):new w(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&y.isSelectable(n)?new y(t):u.near(t)}}class M extends u{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=h.p2.empty){if(t==h.p2.empty){e.delete(0,e.doc.content.size);let t=u.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new M(e)}map(e){return new M(e)}eq(e){return e instanceof M}getBookmark(){return I}}u.jsonID("all",M);const I={map(){return this},resolve(e){return new M(e)}};function S(e,t,n,r,o,i=!1){if(t.inlineContent)return g.create(e,n);for(let s=r-(o>0?0:1);o>0?s<t.childCount:s>=0;s+=o){let r=t.child(s);if(r.isAtom){if(!i&&y.isSelectable(r))return y.create(e,n-(o<0?r.nodeSize:0))}else{let t=S(e,r,n+o,o<0?r.childCount:0,o,i);if(t)return t}n+=r.nodeSize*o}return null}function b(e,t,n){let r=e.steps.length-1;if(r<t)return;let o,i=e.steps[r];(i instanceof l.Pu||i instanceof l.FC)&&(e.mapping.maps[r].forEach(((e,t,n,r)=>{null==o&&(o=r)})),e.setSelection(u.near(e.doc.resolve(o),n)))}function k(e,t){return t&&e?e.bind(t):e}class E{constructor(e,t,n){this.name=e,this.init=k(t.init,n),this.apply=k(t.apply,n)}}new E("doc",{init(e){return e.doc||e.schema.topNodeType.createAndFill()},apply(e){return e.doc}}),new E("selection",{init(e,t){return e.selection||u.atStart(t.doc)},apply(e){return e.selection}}),new E("storedMarks",{init(e){return e.storedMarks||null},apply(e,t,n,r){return r.selection.$cursor?e.storedMarks:null}}),new E("scrollToSelection",{init(){return 0},apply(e,t){return e.scrolledIntoView?t+1:t}});function $(e,t,n){for(let r in e){let o=e[r];o instanceof Function?o=o.bind(t):"handleDOMEvents"==r&&(o=$(o,t,{})),n[r]=o}return n}class C{constructor(e){this.spec=e,this.props={},e.props&&$(e.props,this,this.props),this.key=e.key?e.key.key:T("plugin")}getState(e){return e[this.key]}}const O=Object.create(null);function T(e){return e in O?e+"$"+ ++O[e]:(O[e]=0,e+"$")}class x{constructor(e="key"){this.key=T(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}class R{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,r,o=this.items.length;for(;;o--){if(this.items.get(o-1).selection){--o;break}}t&&(n=this.remapping(o,this.items.length),r=n.maps.length);let i,s,a=e.tr,p=[],l=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(o,t+1),r=n.maps.length),r--,void l.push(e);if(n){l.push(new N(e.map));let t,o=e.step.map(n.slice(r));o&&a.maybeStep(o).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],p.push(new N(t,void 0,void 0,p.length+l.length))),r--,t&&n.appendMap(t,r)}else a.maybeStep(e.step);return e.selection?(i=n?e.selection.map(n.slice(r)):e.selection,s=new R(this.items.slice(0,o).append(l.reverse().concat(p)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:s,transform:a,selection:i}}addTransform(e,t,n,r){let o=[],i=this.eventCount,s=this.items,a=!r&&s.length?s.get(s.length-1):null;for(let n=0;n<e.steps.length;n++){let p,l=e.steps[n].invert(e.docs[n]),h=new N(e.mapping.maps[n],l,t);(p=a&&a.merge(h))&&(h=p,n?o.pop():s=s.slice(0,s.length-1)),o.push(h),t&&(i++,t=void 0),r||(a=h)}let p=i-n.depth;return p>J&&(s=function(e,t){let n;return e.forEach(((e,r)=>{if(e.selection&&0==t--)return n=r,!1})),e.slice(n)}(s,p),i-=p),new R(s.append(o),i)}remapping(e,t){let n=new l.vs;return this.items.forEach(((t,r)=>{let o=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,o)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new R(this.items.append(e.map((e=>new N(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),o=e.mapping,i=e.steps.length,s=this.eventCount;this.items.forEach((e=>{e.selection&&s--}),r);let a=t;this.items.forEach((t=>{let r=o.getMirror(--a);if(null==r)return;i=Math.min(i,r);let p=o.maps[r];if(t.step){let i=e.steps[r].invert(e.docs[r]),l=t.selection&&t.selection.map(o.slice(a+1,r));l&&s++,n.push(new N(p,i,l))}else n.push(new N(p))}),r);let p=[];for(let e=t;e<i;e++)p.push(new N(o.maps[e]));let l=this.items.slice(0,r).append(p).append(n),h=new R(l,s);return h.emptyItemCount()>500&&(h=h.compress(this.items.length-n.length)),h}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],o=0;return this.items.forEach(((i,s)=>{if(s>=e)r.push(i),i.selection&&o++;else if(i.step){let e=i.step.map(t.slice(n)),s=e&&e.getMap();if(n--,s&&t.appendMap(s,n),e){let a=i.selection&&i.selection.map(t.slice(n));a&&o++;let p,l=new N(s.invert(),e,a),h=r.length-1;(p=r.length&&r[h].merge(l))?r[h]=p:r.push(l)}}else i.map&&n--}),this.items.length,0),new R(p.from(r.reverse()),o)}}R.empty=new R(p.empty,0);class N{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new N(t.getMap().invert(),t,this.selection)}}}class D{constructor(e,t,n,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r}}const J=20;function _(e){let t=[];return e.forEach(((e,n,r,o)=>t.push(r,o))),t}function j(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let o=t.map(e[r],1),i=t.map(e[r+1],-1);o<=i&&n.push(o,i)}return n}function F(e,t,n,r){let o=z(t),i=B.get(t).spec.config,s=(r?e.undone:e.done).popEvent(t,o);if(!s)return;let a=s.selection.resolve(s.transform.doc),p=(r?e.done:e.undone).addTransform(s.transform,t.selection.getBookmark(),i,o),l=new D(r?p:s.remaining,r?s.remaining:p,null,0);n(s.transform.setSelection(a).setMeta(B,{redo:r,historyState:l}).scrollIntoView())}let A=!1,P=null;function z(e){let t=e.plugins;if(P!=t){A=!1,P=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){A=!0;break}}return A}const B=new x("history"),H=new x("closeHistory");function q(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new C({key:B,state:{init(){return new D(R.empty,R.empty,null,0)},apply(t,n,r){return function(e,t,n,r){let o,i=n.getMeta(B);if(i)return i.historyState;n.getMeta(H)&&(e=new D(e.done,e.undone,null,0));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(s&&s.getMeta(B))return s.getMeta(B).redo?new D(e.done.addTransform(n,void 0,r,z(t)),e.undone,_(n.mapping.maps[n.steps.length-1]),e.prevTime):new D(e.done,e.undone.addTransform(n,void 0,r,z(t)),null,e.prevTime);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new D(e.done.rebased(n,o),e.undone.rebased(n,o),j(e.prevRanges,n.mapping),e.prevTime):new D(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),j(e.prevRanges,n.mapping),e.prevTime);{let o=0==e.prevTime||!s&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,r)=>{for(let o=0;o<t.length;o+=2)e<=t[o+1]&&r>=t[o]&&(n=!0)})),n}(n,e.prevRanges)),i=s?j(e.prevRanges,n.mapping):_(n.mapping.maps[n.steps.length-1]);return new D(e.done.addTransform(n,o?t.selection.getBookmark():void 0,r,z(t)),R.empty,i,n.time)}}(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r="historyUndo"==n?G:"historyRedo"==n?K:null;return!!r&&(t.preventDefault(),r(e.state,e.dispatch))}}}})}const G=(e,t)=>{let n=B.getState(e);return!(!n||0==n.done.eventCount)&&(t&&F(n,e,t,!1),!0)},K=(e,t)=>{let n=B.getState(e);return!(!n||0==n.undone.eventCount)&&(t&&F(n,e,t,!0),!0)};const V=r.Extension.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>G(e,t),redo:()=>({state:e,dispatch:t})=>K(e,t)}},addProseMirrorPlugins(){return[q(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}})}}]);
//# sourceMappingURL=84819.617437439428f3b7105e.min.js.map