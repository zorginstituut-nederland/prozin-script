"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[67268],{67268:function(t,e,r){r.r(e),r.d(e,{Table:function(){return ie},createTable:function(){return oe},default:function(){return ie}});for(var n=r(92114),o=r(2376),l=r(87823),i=r(84348),s={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},a={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},p="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),h="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),c="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),d="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),f="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),u=p&&(d||+p[1]<57)||c&&d,m=0;m<10;m++)s[48+m]=s[96+m]=String(m);for(m=1;m<=24;m++)s[m+111]="F"+m;for(m=65;m<=90;m++)s[m]=String.fromCharCode(m+32),a[m]=String.fromCharCode(m);for(var g in s)a.hasOwnProperty(g)||(a[g]=s[g]);const w="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function y(t){let e,r,n,o,l=t.split(/-(?!$)/),i=l[l.length-1];"Space"==i&&(i=" ");for(let t=0;t<l.length-1;t++){let i=l[t];if(/^(cmd|meta|m)$/i.test(i))o=!0;else if(/^a(lt)?$/i.test(i))e=!0;else if(/^(c|ctrl|control)$/i.test(i))r=!0;else if(/^s(hift)?$/i.test(i))n=!0;else{if(!/^mod$/i.test(i))throw new Error("Unrecognized modifier name: "+i);w?o=!0:r=!0}}return e&&(i="Alt-"+i),r&&(i="Ctrl-"+i),o&&(i="Meta-"+i),n&&(i="Shift-"+i),i}function b(t,e,r){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==r&&e.shiftKey&&(t="Shift-"+t),t}const C=Math.pow(2,16);function v(t){return 65535&t}class S{constructor(t,e,r){this.pos=t,this.delInfo=e,this.recover=r}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class k{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&k.empty)return k.empty}recover(t){let e=0,r=v(t);if(!this.inverted)for(let t=0;t<r;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*r]+e+function(t){return(t-(65535&t))/C}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,r){let n=0,o=this.inverted?2:1,l=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let s=this.ranges[i]-(this.inverted?n:0);if(s>t)break;let a=this.ranges[i+o],p=this.ranges[i+l],h=s+a;if(t<=h){let o=s+n+((a?t==s?-1:t==h?1:e:e)<0?0:p);if(r)return o;let l=t==(e<0?s:h)?null:i/3+(t-s)*C,c=t==s?2:t==h?1:4;return(e<0?t!=s:t!=h)&&(c|=8),new S(o,c,l)}n+=p-a}return r?t+n:new S(t+n,0,null)}touches(t,e){let r=0,n=v(e),o=this.inverted?2:1,l=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let i=this.ranges[e]-(this.inverted?r:0);if(i>t)break;let s=this.ranges[e+o];if(t<=i+s&&e==3*n)return!0;r+=this.ranges[e+l]-s}return!1}forEach(t){let e=this.inverted?2:1,r=this.inverted?1:2;for(let n=0,o=0;n<this.ranges.length;n+=3){let l=this.ranges[n],i=l-(this.inverted?o:0),s=l+(this.inverted?0:o),a=this.ranges[n+e],p=this.ranges[n+r];t(i,i+a,s,s+p),o+=p-a}}invert(){return new k(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?k.empty:new k(t<0?[0,-t,0]:[0,0,t])}}k.empty=new k([]);class A{constructor(t=[],e,r=0,n=t.length){this.maps=t,this.mirror=e,this.from=r,this.to=n}slice(t=0,e=this.maps.length){return new A(this.maps,this.mirror,t,e)}copy(){return new A(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,r=this.maps.length;e<t.maps.length;e++){let n=t.getMirror(e);this.appendMap(t.maps[e],null!=n&&n<e?r+n:void 0)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){let n=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=n&&n>e?r-n-1:void 0)}}invert(){let t=new A;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,r){let n=0;for(let r=this.from;r<this.to;r++){let o=this.maps[r].mapResult(t,e);if(null!=o.recover){let e=this.getMirror(r);if(null!=e&&e>r&&e<this.to){r=e,t=this.maps[e].recover(o.recover);continue}}n|=o.delInfo,t=o.pos}return r?t:new S(t,n,null)}}const M=Object.create(null);class N{getMap(){return k.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=M[e.stepType];if(!r)throw new RangeError(`No step type ${e.stepType} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in M)throw new RangeError("Duplicate use of step JSON ID "+t);return M[t]=e,e.prototype.jsonID=t,e}}class R{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new R(t,null)}static fail(t){return new R(null,t)}static fromReplace(t,e,r,n){try{return R.ok(t.replace(e,r,n))}catch(t){if(t instanceof l.e4)return R.fail(t.message);throw t}}}function $(t,e,r){let n=[];for(let o=0;o<t.childCount;o++){let l=t.child(o);l.content.size&&(l=l.copy($(l.content,e,l))),l.isInline&&(l=e(l,r,o)),n.push(l)}return l.HY.fromArray(n)}class x extends N{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=t.resolve(this.from),n=r.node(r.sharedDepth(this.to)),o=new l.p2($(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),n),e.openStart,e.openEnd);return R.fromReplace(t,this.from,this.to,o)}invert(){return new E(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new x(e.pos,r.pos,this.mark)}merge(t){return t instanceof x&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new x(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new x(e.from,e.to,t.markFromJSON(e.mark))}}N.jsonID("addMark",x);class E extends N{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=new l.p2($(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return R.fromReplace(t,this.from,this.to,r)}invert(){return new x(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new E(e.pos,r.pos,this.mark)}merge(t){return t instanceof E&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new E(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new E(e.from,e.to,t.markFromJSON(e.mark))}}N.jsonID("removeMark",E);class T extends N{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return R.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return R.fromReplace(t,this.pos,this.pos+1,new l.p2(l.HY.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(t))return new T(this.pos,e.marks[r]);return new T(this.pos,this.mark)}}return new z(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new T(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new T(e.pos,t.markFromJSON(e.mark))}}N.jsonID("addNodeMark",T);class z extends N{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return R.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return R.fromReplace(t,this.pos,this.pos+1,new l.p2(l.HY.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new T(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new z(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new z(e.pos,t.markFromJSON(e.mark))}}N.jsonID("removeNodeMark",z);class H extends N{constructor(t,e,r,n=!1){super(),this.from=t,this.to=e,this.slice=r,this.structure=n}apply(t){return this.structure&&I(t,this.from,this.to)?R.fail("Structure replace would overwrite content"):R.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new k([this.from,this.to-this.from,this.slice.size])}invert(t){return new H(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deletedAcross&&r.deletedAcross?null:new H(e.pos,Math.max(e.pos,r.pos),this.slice)}merge(t){if(!(t instanceof H)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?l.p2.empty:new l.p2(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new H(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?l.p2.empty:new l.p2(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new H(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new H(e.from,e.to,l.p2.fromJSON(t,e.slice),!!e.structure)}}N.jsonID("replace",H);class O extends N{constructor(t,e,r,n,o,l,i=!1){super(),this.from=t,this.to=e,this.gapFrom=r,this.gapTo=n,this.slice=o,this.insert=l,this.structure=i}apply(t){if(this.structure&&(I(t,this.from,this.gapFrom)||I(t,this.gapTo,this.to)))return R.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return R.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,e.content);return r?R.fromReplace(t,this.from,this.to,r):R.fail("Content does not fit in gap")}getMap(){return new k([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new O(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),n=t.map(this.gapFrom,-1),o=t.map(this.gapTo,1);return e.deletedAcross&&r.deletedAcross||n<e.pos||o>r.pos?null:new O(e.pos,r.pos,n,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new O(e.from,e.to,e.gapFrom,e.gapTo,l.p2.fromJSON(t,e.slice),e.insert,!!e.structure)}}function I(t,e,r){let n=t.resolve(e),o=r-e,l=n.depth;for(;o>0&&l>0&&n.indexAfter(l)==n.node(l).childCount;)l--,o--;if(o>0){let t=n.node(l).maybeChild(n.indexAfter(l));for(;o>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,o--}}return!1}function F(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}N.jsonID("replaceAround",O);class D{constructor(t,e,r){this.$from=t,this.$to=e,this.unplaced=r,this.frontier=[],this.placed=l.HY.empty;for(let e=0;e<=t.depth;e++){let r=t.node(e);this.frontier.push({type:r.type,match:r.contentMatchAt(t.indexAfter(e))})}for(let e=t.depth;e>0;e--)this.placed=l.HY.from(t.node(e).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,r=this.$from,n=this.close(t<0?this.$to:r.doc.resolve(t));if(!n)return null;let o=this.placed,i=r.depth,s=n.depth;for(;i&&s&&1==o.childCount;)o=o.firstChild.content,i--,s--;let a=new l.p2(o,i,s);return t>-1?new O(r.pos,t,this.$to.pos,this.$to.end(),a,e):a.size||r.pos!=this.$to.pos?new H(r.pos,n.pos,a):null}findFittable(){for(let t=1;t<=2;t++)for(let e=this.unplaced.openStart;e>=0;e--){let r,n=null;e?(n=J(this.unplaced.content,e-1).firstChild,r=n.content):r=this.unplaced.content;let o=r.firstChild;for(let r=this.depth;r>=0;r--){let i,{type:s,match:a}=this.frontier[r],p=null;if(1==t&&(o?a.matchType(o.type)||(p=a.fillBefore(l.HY.from(o),!1)):n&&s.compatibleContent(n.type)))return{sliceDepth:e,frontierDepth:r,parent:n,inject:p};if(2==t&&o&&(i=a.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:r,parent:n,wrap:i};if(n&&a.matchType(n.type))break}}}openMore(){let{content:t,openStart:e,openEnd:r}=this.unplaced,n=J(t,e);return!(!n.childCount||n.firstChild.isLeaf)&&(this.unplaced=new l.p2(t,e+1,Math.max(r,n.size+e>=t.size-r?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:r}=this.unplaced,n=J(t,e);if(n.childCount<=1&&e>0){let o=t.size-e<=e+n.size;this.unplaced=new l.p2(Y(t,e-1,1),e-1,o?e-1:r)}else this.unplaced=new l.p2(Y(t,e,1),e,r)}placeNodes({sliceDepth:t,frontierDepth:e,parent:r,inject:n,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let t=0;t<o.length;t++)this.openFrontierNode(o[t]);let i=this.unplaced,s=r?r.content:i.content,a=i.openStart-t,p=0,h=[],{match:c,type:d}=this.frontier[e];if(n){for(let t=0;t<n.childCount;t++)h.push(n.child(t));c=c.matchFragment(n)}let f=s.size+t-(i.content.size-i.openEnd);for(;p<s.childCount;){let t=s.child(p),e=c.matchType(t.type);if(!e)break;p++,(p>1||0==a||t.content.size)&&(c=e,h.push(L(t.mark(d.allowedMarks(t.marks)),1==p?a:0,p==s.childCount?f:-1)))}let u=p==s.childCount;u||(f=-1),this.placed=B(this.placed,e,l.HY.from(h)),this.frontier[e].match=c,u&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let t=0,e=s;t<f;t++){let t=e.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),e=t.content}this.unplaced=u?0==t?l.p2.empty:new l.p2(Y(i.content,t-1,1),t-1,f<0?i.openEnd:t-1):new l.p2(Y(i.content,t,p),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,e=this.frontier[this.depth];if(!e.type.isTextblock||!W(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,n=this.$to.after(r);for(;r>1&&n==this.$to.end(--r);)++n;return n}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:r,type:n}=this.frontier[e],o=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),l=W(t,e,n,r,o);if(l){for(let r=e-1;r>=0;r--){let{match:e,type:n}=this.frontier[r],o=W(t,r,n,e,!0);if(!o||o.childCount)continue t}return{depth:e,fit:l,move:o?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=B(this.placed,e.depth,e.fit)),t=e.move;for(let r=e.depth+1;r<=t.depth;r++){let e=t.node(r),n=e.type.contentMatch.fillBefore(e.content,!0,t.index(r));this.openFrontierNode(e.type,e.attrs,n)}return t}openFrontierNode(t,e=null,r){let n=this.frontier[this.depth];n.match=n.match.matchType(t),this.placed=B(this.placed,this.depth,l.HY.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(l.HY.empty,!0);t.childCount&&(this.placed=B(this.placed,this.frontier.length,t))}}function Y(t,e,r){return 0==e?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(Y(t.firstChild.content,e-1,r)))}function B(t,e,r){return 0==e?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(B(t.lastChild.content,e-1,r)))}function J(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function L(t,e,r){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,L(n.firstChild,e-1,1==n.childCount?r-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(l.HY.empty,!0)))),t.copy(n)}function W(t,e,r,n,o){let l=t.node(e),i=o?t.indexAfter(e):t.index(e);if(i==l.childCount&&!r.compatibleContent(l.type))return null;let s=n.fillBefore(l.content,!0,i);return s&&!function(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}(r,l.content,i)?s:null}function _(t){return t.spec.defining||t.spec.definingForContent}function K(t,e,r,n,o){if(e<r){let o=t.firstChild;t=t.replaceChild(0,o.copy(K(o.content,e+1,r,n,o)))}if(e>n){let e=o.contentMatchAt(0),r=e.fillBefore(t).append(t);t=r.append(e.matchFragment(r).fillBefore(l.HY.empty,!0))}return t}function j(t,e){let r=[];for(let n=Math.min(t.depth,e.depth);n>=0;n--){let o=t.start(n);if(o<t.pos-(t.depth-n)||e.end(n)>e.pos+(e.depth-n)||t.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;(o==e.start(n)||n==t.depth&&n==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&n&&e.start(n-1)==o-1)&&r.push(n)}return r}class P extends N{constructor(t,e,r){super(),this.pos=t,this.attr=e,this.value=r}apply(t){let e=t.nodeAt(this.pos);if(!e)return R.fail("No node at attribute step's position");let r=Object.create(null);for(let t in e.attrs)r[t]=e.attrs[t];r[this.attr]=this.value;let n=e.type.create(r,null,e.marks);return R.fromReplace(t,this.pos,this.pos+1,new l.p2(l.HY.from(n),0,e.isLeaf?0:1))}getMap(){return k.empty}invert(t){return new P(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new P(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new P(e.pos,e.attr,e.value)}}N.jsonID("attr",P);let q,V,U=class extends Error{};U=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r},(U.prototype=Object.create(Error.prototype)).constructor=U,U.prototype.name="TransformError";class X{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new A}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new U(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,r=l.p2.empty){let n=function(t,e,r=e,n=l.p2.empty){if(e==r&&!n.size)return null;let o=t.resolve(e),i=t.resolve(r);return F(o,i,n)?new H(e,r,n):new D(o,i,n).fit()}(this.doc,t,e,r);return n&&this.step(n),this}replaceWith(t,e,r){return this.replace(t,e,new l.p2(l.HY.from(r),0,0))}delete(t,e){return this.replace(t,e,l.p2.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,r){return function(t,e,r,n){if(!n.size)return t.deleteRange(e,r);let o=t.doc.resolve(e),i=t.doc.resolve(r);if(F(o,i,n))return t.step(new H(e,r,n));let s=j(o,t.doc.resolve(r));0==s[s.length-1]&&s.pop();let a=-(o.depth+1);s.unshift(a);for(let t=o.depth,e=o.pos-1;t>0;t--,e--){let r=o.node(t).type.spec;if(r.defining||r.definingAsContext||r.isolating)break;s.indexOf(t)>-1?a=t:o.before(t)==e&&s.splice(1,0,-t)}let p=s.indexOf(a),h=[],c=n.openStart;for(let t=n.content,e=0;;e++){let r=t.firstChild;if(h.push(r),e==n.openStart)break;t=r.content}for(let t=c-1;t>=0;t--){let e=h[t].type,r=_(e);if(r&&o.node(p).type!=e)c=t;else if(r||!e.isTextblock)break}for(let e=n.openStart;e>=0;e--){let a=(e+c+1)%(n.openStart+1),d=h[a];if(d)for(let e=0;e<s.length;e++){let h=s[(e+p)%s.length],c=!0;h<0&&(c=!1,h=-h);let f=o.node(h-1),u=o.index(h-1);if(f.canReplaceWith(u,u,d.type,d.marks))return t.replace(o.before(h),c?i.after(h):r,new l.p2(K(n.content,0,n.openStart,a),a,n.openEnd))}}let d=t.steps.length;for(let l=s.length-1;l>=0&&(t.replace(e,r,n),!(t.steps.length>d));l--){let t=s[l];t<0||(e=o.before(t),r=i.after(t))}}(this,t,e,r),this}replaceRangeWith(t,e,r){return function(t,e,r,n){if(!n.isInline&&e==r&&t.doc.resolve(e).parent.content.size){let o=function(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(0==n.parentOffset)for(let t=n.depth-1;t>=0;t--){let e=n.index(t);if(n.node(t).canReplaceWith(e,e,r))return n.before(t+1);if(e>0)return null}if(n.parentOffset==n.parent.content.size)for(let t=n.depth-1;t>=0;t--){let e=n.indexAfter(t);if(n.node(t).canReplaceWith(e,e,r))return n.after(t+1);if(e<n.node(t).childCount)return null}return null}(t.doc,e,n.type);null!=o&&(e=r=o)}t.replaceRange(e,r,new l.p2(l.HY.from(n),0,0))}(this,t,e,r),this}deleteRange(t,e){return function(t,e,r){let n=t.doc.resolve(e),o=t.doc.resolve(r),l=j(n,o);for(let e=0;e<l.length;e++){let r=l[e],i=e==l.length-1;if(i&&0==r||n.node(r).type.contentMatch.validEnd)return t.delete(n.start(r),o.end(r));if(r>0&&(i||n.node(r-1).canReplace(n.index(r-1),o.indexAfter(r-1))))return t.delete(n.before(r),o.after(r))}for(let l=1;l<=n.depth&&l<=o.depth;l++)if(e-n.start(l)==n.depth-l&&r>n.end(l)&&o.end(l)-r!=o.depth-l)return t.delete(n.before(l),r);t.delete(e,r)}(this,t,e),this}lift(t,e){return function(t,e,r){let{$from:n,$to:o,depth:i}=e,s=n.before(i+1),a=o.after(i+1),p=s,h=a,c=l.HY.empty,d=0;for(let t=i,e=!1;t>r;t--)e||n.index(t)>0?(e=!0,c=l.HY.from(n.node(t).copy(c)),d++):p--;let f=l.HY.empty,u=0;for(let t=i,e=!1;t>r;t--)e||o.after(t+1)<o.end(t)?(e=!0,f=l.HY.from(o.node(t).copy(f)),u++):h++;t.step(new O(p,h,s,a,new l.p2(c.append(f),d,u),c.size-d,!0))}(this,t,e),this}join(t,e=1){return function(t,e,r){let n=new H(e-r,e+r,l.p2.empty,!0);t.step(n)}(this,t,e),this}wrap(t,e){return function(t,e,r){let n=l.HY.empty;for(let t=r.length-1;t>=0;t--){if(n.size){let e=r[t].type.contentMatch.matchFragment(n);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=l.HY.from(r[t].type.create(r[t].attrs,n))}let o=e.start,i=e.end;t.step(new O(o,i,o,i,new l.p2(n,0,0),r.length,!0))}(this,t,e),this}setBlockType(t,e=t,r,n=null){return function(t,e,r,n,o){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,r,((e,r)=>{if(e.isTextblock&&!e.hasMarkup(n,o)&&function(t,e,r){let n=t.resolve(e),o=n.index();return n.parent.canReplaceWith(o,o+1,r)}(t.doc,t.mapping.slice(i).map(r),n)){t.clearIncompatible(t.mapping.slice(i).map(r,1),n);let s=t.mapping.slice(i),a=s.map(r,1),p=s.map(r+e.nodeSize,1);return t.step(new O(a,p,a+1,p-1,new l.p2(l.HY.from(n.create(o,null,e.marks)),0,0),1,!0)),!1}}))}(this,t,e,r,n),this}setNodeMarkup(t,e,r=null,n=[]){return function(t,e,r,n,o){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");r||(r=i.type);let s=r.create(n,null,o||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,s);if(!r.validContent(i.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new O(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new l.p2(l.HY.from(s),0,0),1,!0))}(this,t,e,r,n),this}setNodeAttribute(t,e,r){return this.step(new P(t,e,r)),this}addNodeMark(t,e){return this.step(new T(t,e)),this}removeNodeMark(t,e){if(!(e instanceof l.vc)){let r=this.doc.nodeAt(t);if(!r)throw new RangeError("No node at position "+t);if(!(e=e.isInSet(r.marks)))return this}return this.step(new z(t,e)),this}split(t,e=1,r){return function(t,e,r=1,n){let o=t.doc.resolve(e),i=l.HY.empty,s=l.HY.empty;for(let t=o.depth,e=o.depth-r,a=r-1;t>e;t--,a--){i=l.HY.from(o.node(t).copy(i));let e=n&&n[a];s=l.HY.from(e?e.type.create(e.attrs,s):o.node(t).copy(s))}t.step(new H(e,e,new l.p2(i.append(s),r,r),!0))}(this,t,e,r),this}addMark(t,e,r){return function(t,e,r,n){let o,l,i=[],s=[];t.doc.nodesBetween(e,r,((t,a,p)=>{if(!t.isInline)return;let h=t.marks;if(!n.isInSet(h)&&p.type.allowsMarkType(n.type)){let p=Math.max(a,e),c=Math.min(a+t.nodeSize,r),d=n.addToSet(h);for(let t=0;t<h.length;t++)h[t].isInSet(d)||(o&&o.to==p&&o.mark.eq(h[t])?o.to=c:i.push(o=new E(p,c,h[t])));l&&l.to==p?l.to=c:s.push(l=new x(p,c,n))}})),i.forEach((e=>t.step(e))),s.forEach((e=>t.step(e)))}(this,t,e,r),this}removeMark(t,e,r){return function(t,e,r,n){let o=[],i=0;t.doc.nodesBetween(e,r,((t,s)=>{if(!t.isInline)return;i++;let a=null;if(n instanceof l.ZU){let e,r=t.marks;for(;e=n.isInSet(r);)(a||(a=[])).push(e),r=e.removeFromSet(r)}else n?n.isInSet(t.marks)&&(a=[n]):a=t.marks;if(a&&a.length){let n=Math.min(s+t.nodeSize,r);for(let t=0;t<a.length;t++){let r,l=a[t];for(let t=0;t<o.length;t++){let e=o[t];e.step==i-1&&l.eq(o[t].style)&&(r=e)}r?(r.to=n,r.step=i):o.push({style:l,from:Math.max(s,e),to:n,step:i})}}})),o.forEach((e=>t.step(new E(e.from,e.to,e.style))))}(this,t,e,r),this}clearIncompatible(t,e,r){return function(t,e,r,n=r.contentMatch){let o=t.doc.nodeAt(e),i=[],s=e+1;for(let e=0;e<o.childCount;e++){let a=o.child(e),p=s+a.nodeSize,h=n.matchType(a.type);if(h){n=h;for(let e=0;e<a.marks.length;e++)r.allowsMarkType(a.marks[e].type)||t.step(new E(s,p,a.marks[e]))}else i.push(new H(s,p,l.p2.empty));s=p}if(!n.validEnd){let e=n.fillBefore(l.HY.empty,!0);t.replace(s,s,new l.p2(e,0,0))}for(let e=i.length-1;e>=0;e--)t.step(i[e])}(this,t,e,r),this}}if("undefined"!=typeof WeakMap){let t=new WeakMap;q=e=>t.get(e),V=(e,r)=>(t.set(e,r),r)}else{let t=[],e=10,r=0;q=e=>{for(let r=0;r<t.length;r+=2)if(t[r]==e)return t[r+1]},V=(n,o)=>(r==e&&(r=0),t[r++]=n,t[r++]=o)}class G{constructor(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n}}class Q{constructor(t,e,r,n){this.width=t,this.height=e,this.map=r,this.problems=n}findCell(t){for(let e=0;e<this.map.length;e++){let r=this.map[e];if(r!=t)continue;let n=e%this.width,o=e/this.width|0,l=n+1,i=o+1;for(let t=1;l<this.width&&this.map[e+t]==r;t++)l++;for(let t=1;i<this.height&&this.map[e+this.width*t]==r;t++)i++;return new G(n,o,l,i)}throw new RangeError("No cell with offset "+t+" found")}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError("No cell with offset "+t+" found")}nextCell(t,e,r){let{left:n,right:o,top:l,bottom:i}=this.findCell(t);return"horiz"==e?(r<0?0==n:o==this.width)?null:this.map[l*this.width+(r<0?n-1:o)]:(r<0?0==l:i==this.height)?null:this.map[n+this.width*(r<0?l-1:i)]}rectBetween(t,e){let{left:r,right:n,top:o,bottom:l}=this.findCell(t),{left:i,right:s,top:a,bottom:p}=this.findCell(e);return new G(Math.min(r,i),Math.min(o,a),Math.max(n,s),Math.max(l,p))}cellsInRect(t){let e=[],r={};for(let n=t.top;n<t.bottom;n++)for(let o=t.left;o<t.right;o++){let l=n*this.width+o,i=this.map[l];r[i]||(r[i]=!0,o==t.left&&o&&this.map[l-1]==i||n==t.top&&n&&this.map[l-this.width]==i||e.push(i))}return e}positionAt(t,e,r){for(let n=0,o=0;;n++){let l=o+r.child(n).nodeSize;if(n==t){let r=e+t*this.width,n=(t+1)*this.width;for(;r<n&&this.map[r]<o;)r++;return r==n?l-1:this.map[r]}o=l}}static get(t){return q(t)||V(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);let e=function(t){let e=-1,r=!1;for(let n=0;n<t.childCount;n++){let o=t.child(n),l=0;if(r)for(let e=0;e<n;e++){let r=t.child(e);for(let t=0;t<r.childCount;t++){let o=r.child(t);e+o.attrs.rowspan>n&&(l+=o.attrs.colspan)}}for(let t=0;t<o.childCount;t++){let e=o.child(t);l+=e.attrs.colspan,e.attrs.rowspan>1&&(r=!0)}-1==e?e=l:e!=l&&(e=Math.max(e,l))}return e}(t),r=t.childCount,n=[],o=0,l=null,i=[];for(let t=0,o=e*r;t<o;t++)n[t]=0;for(let s=0,a=0;s<r;s++){let p=t.child(s);a++;for(let t=0;;t++){for(;o<n.length&&0!=n[o];)o++;if(t==p.childCount)break;let h=p.child(t),{colspan:c,rowspan:d,colwidth:f}=h.attrs;for(let t=0;t<d;t++){if(t+s>=r){(l||(l=[])).push({type:"overlong_rowspan",pos:a,n:d-t});break}let p=o+t*e;for(let t=0;t<c;t++){0==n[p+t]?n[p+t]=a:(l||(l=[])).push({type:"collision",row:s,pos:a,n:c-t});let r=f&&f[t];if(r){let n=(p+t)%e*2,o=i[n];null==o||o!=r&&1==i[n+1]?(i[n]=r,i[n+1]=1):o==r&&i[n+1]++}}}o+=c,a+=h.nodeSize}let h=(s+1)*e,c=0;for(;o<h;)0==n[o++]&&c++;c&&(l||(l=[])).push({type:"missing",row:s,n:c}),a++}let s=new Q(e,r,n,l),a=!1;for(let t=0;!a&&t<i.length;t+=2)null!=i[t]&&i[t+1]<r&&(a=!0);a&&function(t,e,r){t.problems||(t.problems=[]);for(let n=0,o={};n<t.map.length;n++){let l=t.map[n];if(o[l])continue;o[l]=!0;let i=r.nodeAt(l),s=null;for(let r=0;r<i.attrs.colspan;r++){let o=e[2*((n+r)%t.width)];null==o||i.attrs.colwidth&&i.attrs.colwidth[r]==o||((s||(s=Z(i.attrs)))[r]=o)}s&&t.problems.unshift({type:"colwidth mismatch",pos:l,colwidth:s})}}(s,i,t);return s}(t))}}function Z(t){if(t.colwidth)return t.colwidth.slice();let e=[];for(let r=0;r<t.colspan;r++)e.push(0);return e}function tt(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(let r in t.nodes){let n=t.nodes[r],o=n.spec.tableRole;o&&(e[o]=n)}}return e}const et=new o.H$("selectingCells");function rt(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function nt(t){let e=t.selection.$head;for(let t=e.depth;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return!0;return!1}function ot(t){let e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&"cell"==e.node.type.spec.tableRole?e.$anchor:rt(e.$head)||function(t){for(let e=t.nodeAfter,r=t.pos;e;e=e.firstChild,r++){let n=e.type.spec.tableRole;if("cell"==n||"header_cell"==n)return t.doc.resolve(r)}for(let e=t.nodeBefore,r=t.pos;e;e=e.lastChild,r--){let n=e.type.spec.tableRole;if("cell"==n||"header_cell"==n)return t.doc.resolve(r-e.nodeSize)}}(e.$head)}function lt(t){return"row"==t.parent.type.spec.tableRole&&t.nodeAfter}function it(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function st(t,e,r){let n=t.start(-1),o=Q.get(t.node(-1)).nextCell(t.pos-n,e,r);return null==o?null:t.node(0).resolve(n+o)}function at(t,e,r){let n={};for(let e in t)n[e]=t[e];return n[e]=r,n}function pt(t,e,r=1){let n=at(t,"colspan",t.colspan-r);return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(e,r),n.colwidth.some((t=>t>0))||(n.colwidth=null)),n}function ht(t,e,r=1){let n=at(t,"colspan",t.colspan+r);if(n.colwidth){n.colwidth=n.colwidth.slice();for(let t=0;t<r;t++)n.colwidth.splice(e,0,0)}return n}class ct extends o.Y1{constructor(t,e=t){let r=t.node(-1),n=Q.get(r),l=t.start(-1),i=n.rectBetween(t.pos-l,e.pos-l),s=t.node(0),a=n.cellsInRect(i).filter((t=>t!=e.pos-l));a.unshift(e.pos-l);let p=a.map((t=>{let e=r.nodeAt(t),n=t+l+1;return new o.xm(s.resolve(n),s.resolve(n+e.content.size))}));super(p[0].$from,p[0].$to,p),this.$anchorCell=t,this.$headCell=e}map(t,e){let r=t.resolve(e.map(this.$anchorCell.pos)),n=t.resolve(e.map(this.$headCell.pos));if(lt(r)&&lt(n)&&it(r,n)){let t=this.$anchorCell.node(-1)!=r.node(-1);return t&&this.isRowSelection()?ct.rowSelection(r,n):t&&this.isColSelection()?ct.colSelection(r,n):new ct(r,n)}return o.Bs.between(r,n)}content(){let t=this.$anchorCell.node(-1),e=Q.get(t),r=this.$anchorCell.start(-1),n=e.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),o={},i=[];for(let r=n.top;r<n.bottom;r++){let s=[];for(let l=r*e.width+n.left,i=n.left;i<n.right;i++,l++){let r=e.map[l];if(!o[r]){o[r]=!0;let l=e.findCell(r),i=t.nodeAt(r),a=n.left-l.left,p=l.right-n.right;if(a>0||p>0){let t=i.attrs;a>0&&(t=pt(t,0,a)),p>0&&(t=pt(t,t.colspan-p,p)),i=l.left<n.left?i.type.createAndFill(t):i.type.create(t,i.content)}if(l.top<n.top||l.bottom>n.bottom){let t=at(i.attrs,"rowspan",Math.min(l.bottom,n.bottom)-Math.max(l.top,n.top));i=l.top<n.top?i.type.createAndFill(t):i.type.create(t,i.content)}s.push(i)}}i.push(t.child(r).copy(l.HY.from(s)))}const s=this.isColSelection()&&this.isRowSelection()?t:i;return new l.p2(l.HY.from(s),1,1)}replace(t,e=l.p2.empty){let r=t.steps.length,n=this.ranges;for(let o=0;o<n.length;o++){let{$from:i,$to:s}=n[o],a=t.mapping.slice(r);t.replace(a.map(i.pos),a.map(s.pos),o?l.p2.empty:e)}let i=o.Y1.findFrom(t.doc.resolve(t.mapping.slice(r).map(this.to)),-1);i&&t.setSelection(i)}replaceWith(t,e){this.replace(t,new l.p2(l.HY.from(e),0,0))}forEachCell(t){let e=this.$anchorCell.node(-1),r=Q.get(e),n=this.$anchorCell.start(-1),o=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n));for(let r=0;r<o.length;r++)t(e.nodeAt(o[r]),n+o[r])}isColSelection(){let t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;let r=t+this.$anchorCell.nodeAfter.attrs.rowspan,n=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,n)==this.$headCell.node(-1).childCount}static colSelection(t,e=t){let r=Q.get(t.node(-1)),n=t.start(-1),o=r.findCell(t.pos-n),l=r.findCell(e.pos-n),i=t.node(0);return o.top<=l.top?(o.top>0&&(t=i.resolve(n+r.map[o.left])),l.bottom<r.height&&(e=i.resolve(n+r.map[r.width*(r.height-1)+l.right-1]))):(l.top>0&&(e=i.resolve(n+r.map[l.left])),o.bottom<r.height&&(t=i.resolve(n+r.map[r.width*(r.height-1)+o.right-1]))),new ct(t,e)}isRowSelection(){let t=Q.get(this.$anchorCell.node(-1)),e=this.$anchorCell.start(-1),r=t.colCount(this.$anchorCell.pos-e),n=t.colCount(this.$headCell.pos-e);if(Math.min(r,n)>0)return!1;let o=r+this.$anchorCell.nodeAfter.attrs.colspan,l=n+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,l)==t.width}eq(t){return t instanceof ct&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,e=t){let r=Q.get(t.node(-1)),n=t.start(-1),o=r.findCell(t.pos-n),l=r.findCell(e.pos-n),i=t.node(0);return o.left<=l.left?(o.left>0&&(t=i.resolve(n+r.map[o.top*r.width])),l.right<r.width&&(e=i.resolve(n+r.map[r.width*(l.top+1)-1]))):(l.left>0&&(e=i.resolve(n+r.map[l.top*r.width])),o.right<r.width&&(t=i.resolve(n+r.map[r.width*(o.top+1)-1]))),new ct(t,e)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,e){return new ct(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,r=e){return new ct(t.resolve(e),t.resolve(r))}getBookmark(){return new dt(this.$anchorCell.pos,this.$headCell.pos)}}ct.prototype.visible=!1,o.Y1.jsonID("cell",ct);class dt{constructor(t,e){this.anchor=t,this.head=e}map(t){return new dt(t.map(this.anchor),t.map(this.head))}resolve(t){let e=t.resolve(this.anchor),r=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==r.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&r.index()<r.parent.childCount&&it(e,r)?new ct(e,r):o.Y1.near(r,1)}}function ft(t){if(!(t.selection instanceof ct))return null;let e=[];return t.selection.forEachCell(((t,r)=>{e.push(i.p.node(r,r+t.nodeSize,{class:"selectedCell"}))})),i.EH.create(t.doc,e)}function ut(t){if(!t.size)return null;let{content:e,openStart:r,openEnd:n}=t;for(;1==e.childCount&&(r>0&&n>0||"table"==e.firstChild.type.spec.tableRole);)r--,n--,e=e.firstChild.content;let o=e.firstChild,i=o.type.spec.tableRole,s=o.type.schema,a=[];if("row"==i)for(let t=0;t<e.childCount;t++){let o=e.child(t).content,i=t?0:Math.max(0,r-1),p=t<e.childCount-1?0:Math.max(0,n-1);(i||p)&&(o=mt(tt(s).row,new l.p2(o,i,p)).content),a.push(o)}else{if("cell"!=i&&"header_cell"!=i)return null;a.push(r||n?mt(tt(s).row,new l.p2(e,r,n)).content:e)}return function(t,e){let r=[];for(let t=0;t<e.length;t++){let n=e[t];for(let e=n.childCount-1;e>=0;e--){let{rowspan:o,colspan:l}=n.child(e).attrs;for(let e=t;e<t+o;e++)r[e]=(r[e]||0)+l}}let n=0;for(let t=0;t<r.length;t++)n=Math.max(n,r[t]);for(let o=0;o<r.length;o++)if(o>=e.length&&e.push(l.HY.empty),r[o]<n){let i=tt(t).cell.createAndFill(),s=[];for(let t=r[o];t<n;t++)s.push(i);e[o]=e[o].append(l.HY.from(s))}return{height:e.length,width:n,rows:e}}(s,a)}function mt(t,e){let r=t.createAndFill();return new X(r).replace(0,r.content.size,e).doc}function gt(t,e,r,n,o,l,i,s){if(0==i||i==e.height)return!1;let a=!1;for(let p=o;p<l;p++){let o=i*e.width+p,l=e.map[o];if(e.map[o-e.width]==l){a=!0;let o=r.nodeAt(l),{top:h,left:c}=e.findCell(l);t.setNodeMarkup(t.mapping.slice(s).map(l+n),null,at(o.attrs,"rowspan",i-h)),t.insert(t.mapping.slice(s).map(e.positionAt(i,c,r)),o.type.createAndFill(at(o.attrs,"rowspan",h+o.attrs.rowspan-i))),p+=o.attrs.colspan-1}}return a}function wt(t,e,r,n,o,l,i,s){if(0==i||i==e.width)return!1;let a=!1;for(let p=o;p<l;p++){let o=p*e.width+i,l=e.map[o];if(e.map[o-1]==l){a=!0;let o=r.nodeAt(l),h=e.colCount(l),c=t.mapping.slice(s).map(l+n);t.setNodeMarkup(c,null,pt(o.attrs,i-h,o.attrs.colspan-(i-h))),t.insert(c+o.nodeSize,o.type.createAndFill(pt(o.attrs,0,i-h))),p+=o.attrs.rowspan-1}}return a}function yt(t,e,r,n,o){let i=r?t.doc.nodeAt(r-1):t.doc,s=Q.get(i),{top:a,left:p}=n,h=p+o.width,c=a+o.height,d=t.tr,f=0;function u(){i=r?d.doc.nodeAt(r-1):d.doc,s=Q.get(i),f=d.mapping.maps.length}(function(t,e,r,n,o,i,s){let a,p,h=tt(t.doc.type.schema);if(o>e.width)for(let l=0,i=0;l<e.height;l++){let c=r.child(l);i+=c.nodeSize;let d,f=[];d=null==c.lastChild||c.lastChild.type==h.cell?a||(a=h.cell.createAndFill()):p||(p=h.header_cell.createAndFill());for(let t=e.width;t<o;t++)f.push(d);t.insert(t.mapping.slice(s).map(i-1+n),f)}if(i>e.height){let c=[];for(let t=0,n=(e.height-1)*e.width;t<Math.max(e.width,o);t++){let o=!(t>=e.width)&&r.nodeAt(e.map[n+t]).type==h.header_cell;c.push(o?p||(p=h.header_cell.createAndFill()):a||(a=h.cell.createAndFill()))}let d=h.row.create(null,l.HY.from(c)),f=[];for(let t=e.height;t<i;t++)f.push(d);t.insert(t.mapping.slice(s).map(n+r.nodeSize-2),f)}return!(!a&&!p)})(d,s,i,r,h,c,f)&&u(),gt(d,s,i,r,p,h,a,f)&&u(),gt(d,s,i,r,p,h,c,f)&&u(),wt(d,s,i,r,a,c,p,f)&&u(),wt(d,s,i,r,a,c,h,f)&&u();for(let t=a;t<c;t++){let e=s.positionAt(t,p,i),n=s.positionAt(t,h,i);d.replace(d.mapping.slice(f).map(e+r),d.mapping.slice(f).map(n+r),new l.p2(o.rows[t-a],0,0))}u(),d.setSelection(new ct(d.doc.resolve(r+s.positionAt(a,p,i)),d.doc.resolve(r+s.positionAt(c-1,h-1,i)))),e(d)}const bt=function(t){let e=function(t){let e=Object.create(null);for(let r in t)e[y(r)]=t[r];return e}(t);return function(t,r){let n,o=function(t){var e=!(u&&(t.ctrlKey||t.altKey||t.metaKey)||(h||f)&&t.shiftKey&&t.key&&1==t.key.length)&&t.key||(t.shiftKey?a:s)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(r),l=1==o.length&&" "!=o,i=e[b(o,r,!l)];if(i&&i(t.state,t.dispatch,t))return!0;if(l&&(r.shiftKey||r.altKey||r.metaKey||o.charCodeAt(0)>127)&&(n=s[r.keyCode])&&n!=o){let o=e[b(n,r,!0)];if(o&&o(t.state,t.dispatch,t))return!0}else if(l&&r.shiftKey){let n=e[b(o,r,!0)];if(n&&n(t.state,t.dispatch,t))return!0}return!1}}({ArrowLeft:vt("horiz",-1),ArrowRight:vt("horiz",1),ArrowUp:vt("vert",-1),ArrowDown:vt("vert",1),"Shift-ArrowLeft":St("horiz",-1),"Shift-ArrowRight":St("horiz",1),"Shift-ArrowUp":St("vert",-1),"Shift-ArrowDown":St("vert",1),Backspace:kt,"Mod-Backspace":kt,Delete:kt,"Mod-Delete":kt});function Ct(t,e,r){return!r.eq(t.selection)&&(e&&e(t.tr.setSelection(r).scrollIntoView()),!0)}function vt(t,e){return(r,n,l)=>{let i=r.selection;if(i instanceof ct)return Ct(r,n,o.Y1.near(i.$headCell,e));if("horiz"!=t&&!i.empty)return!1;let s=Rt(l,t,e);if(null==s)return!1;if("horiz"==t)return Ct(r,n,o.Y1.near(r.doc.resolve(i.head+e),e));{let l,i=r.doc.resolve(s),a=st(i,t,e);return l=a?o.Y1.near(a,1):e<0?o.Y1.near(r.doc.resolve(i.before(-1)),-1):o.Y1.near(r.doc.resolve(i.after(-1)),1),Ct(r,n,l)}}}function St(t,e){return(r,n,o)=>{let l=r.selection;if(!(l instanceof ct)){let n=Rt(o,t,e);if(null==n)return!1;l=new ct(r.doc.resolve(n))}let i=st(l.$headCell,t,e);return!!i&&Ct(r,n,new ct(l.$anchorCell,i))}}function kt(t,e){let r=t.selection;if(!(r instanceof ct))return!1;if(e){let n=t.tr,o=tt(t.schema).cell.createAndFill().content;r.forEachCell(((t,e)=>{t.content.eq(o)||n.replace(n.mapping.map(e+1),n.mapping.map(e+t.nodeSize-1),new l.p2(o,0,0))})),n.docChanged&&e(n)}return!0}function At(t,e){let r=rt(t.state.doc.resolve(e));return!!r&&(t.dispatch(t.state.tr.setSelection(new ct(r))),!0)}function Mt(t,e,r){if(!nt(t.state))return!1;let n=ut(r),o=t.state.selection;if(o instanceof ct){n||(n={width:1,height:1,rows:[l.HY.from(mt(tt(t.state.schema).cell,r))]});let e=o.$anchorCell.node(-1),i=o.$anchorCell.start(-1),s=Q.get(e).rectBetween(o.$anchorCell.pos-i,o.$headCell.pos-i);return n=function({width:t,height:e,rows:r},n,o){if(t!=n){let e=[],o=[];for(let t=0;t<r.length;t++){let i=r[t],s=[];for(let r=e[t]||0,o=0;r<n;o++){let l=i.child(o%i.childCount);r+l.attrs.colspan>n&&(l=l.type.create(pt(l.attrs,l.attrs.colspan,r+l.attrs.colspan-n),l.content)),s.push(l),r+=l.attrs.colspan;for(let r=1;r<l.attrs.rowspan;r++)e[t+r]=(e[t+r]||0)+l.attrs.colspan}o.push(l.HY.from(s))}r=o,t=n}if(e!=o){let t=[];for(let n=0,i=0;n<o;n++,i++){let s=[],a=r[i%e];for(let t=0;t<a.childCount;t++){let e=a.child(t);n+e.attrs.rowspan>o&&(e=e.type.create(at(e.attrs,"rowspan",Math.max(1,o-e.attrs.rowspan)),e.content)),s.push(e)}t.push(l.HY.from(s))}r=t,e=o}return{width:t,height:e,rows:r}}(n,s.right-s.left,s.bottom-s.top),yt(t.state,t.dispatch,i,s,n),!0}if(n){let e=ot(t.state),r=e.start(-1);return yt(t.state,t.dispatch,r,Q.get(e.node(-1)).findCell(e.pos-r),n),!0}return!1}function Nt(t,e){if(e.ctrlKey||e.metaKey)return;let r,n=$t(t,e.target);if(e.shiftKey&&t.state.selection instanceof ct)o(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&null!=(r=rt(t.state.selection.$anchor))&&xt(t,e).pos!=r.pos)o(r,e),e.preventDefault();else if(!n)return;function o(e,r){let n=xt(t,r),o=null==et.getState(t.state);if(!n||!it(e,n)){if(!o)return;n=e}let l=new ct(e,n);if(o||!t.state.selection.eq(l)){let r=t.state.tr.setSelection(l);o&&r.setMeta(et,e.pos),t.dispatch(r)}}function l(){t.root.removeEventListener("mouseup",l),t.root.removeEventListener("dragstart",l),t.root.removeEventListener("mousemove",i),null!=et.getState(t.state)&&t.dispatch(t.state.tr.setMeta(et,-1))}function i(r){let i,s=et.getState(t.state);if(null!=s)i=t.state.doc.resolve(s);else if($t(t,r.target)!=n&&(i=xt(t,e),!i))return l();i&&o(i,r)}t.root.addEventListener("mouseup",l),t.root.addEventListener("dragstart",l),t.root.addEventListener("mousemove",i)}function Rt(t,e,r){if(!(t.state.selection instanceof o.Bs))return null;let{$head:n}=t.state.selection;for(let o=n.depth-1;o>=0;o--){let l=n.node(o);if((r<0?n.index(o):n.indexAfter(o))!=(r<0?0:l.childCount))return null;if("cell"==l.type.spec.tableRole||"header_cell"==l.type.spec.tableRole){let l=n.before(o),i="vert"==e?r>0?"down":"up":r>0?"right":"left";return t.endOfTextblock(i)?l:null}}return null}function $t(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e}function xt(t,e){let r=t.posAtCoords({left:e.clientX,top:e.clientY});return r&&r?rt(t.state.doc.resolve(r.pos)):null}const Et=new o.H$("fix-tables");function Tt(t,e,r,n){let o=t.childCount,l=e.childCount;t:for(let i=0,s=0;i<l;i++){let l=e.child(i);for(let e=s,n=Math.min(o,i+3);e<n;e++)if(t.child(e)==l){s=e+1,r+=l.nodeSize;continue t}n(l,r),s<o&&t.child(s).sameMarkup(l)?Tt(t.child(s),l,r+1,n):l.nodesBetween(0,l.content.size,n,r+1),r+=l.nodeSize}}function zt(t,e){let r,n=(e,n)=>{"table"==e.type.spec.tableRole&&(r=function(t,e,r,n){let o=Q.get(e);if(!o.problems)return n;n||(n=t.tr);let l,i,s=[];for(let t=0;t<o.height;t++)s.push(0);for(let t=0;t<o.problems.length;t++){let l=o.problems[t];if("collision"==l.type){let t=e.nodeAt(l.pos);for(let e=0;e<t.attrs.rowspan;e++)s[l.row+e]+=l.n;n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,pt(t.attrs,t.attrs.colspan-l.n,l.n))}else if("missing"==l.type)s[l.row]+=l.n;else if("overlong_rowspan"==l.type){let t=e.nodeAt(l.pos);n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,at(t.attrs,"rowspan",t.attrs.rowspan-l.n))}else if("colwidth mismatch"==l.type){let t=e.nodeAt(l.pos);n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,at(t.attrs,"colwidth",l.colwidth))}}for(let t=0;t<s.length;t++)s[t]&&(null==l&&(l=t),i=t);for(let a=0,p=r+1;a<o.height;a++){let r=e.child(a),o=p+r.nodeSize,h=s[a];if(h>0){let e="cell";r.firstChild&&(e=r.firstChild.type.spec.tableRole);let s=[];for(let r=0;r<h;r++)s.push(tt(t.schema)[e].createAndFill());let c=0!=a&&l!=a-1||i!=a?o-1:p+1;n.insert(n.mapping.map(c),s)}p=o}return n.setMeta(Et,{fixTables:!0})}(t,e,n,r))};return e?e.doc!=t.doc&&Tt(e.doc,t.doc,0,n):t.doc.descendants(n),r}function Ht(t){let e,r=t.selection,n=ot(t),o=n.node(-1),l=n.start(-1),i=Q.get(o);return e=r instanceof ct?i.rectBetween(r.$anchorCell.pos-l,r.$headCell.pos-l):i.findCell(n.pos-l),e.tableStart=l,e.map=i,e.table=o,e}function Ot(t,{map:e,tableStart:r,table:n},o){let l=o>0?-1:0;(function(t,e,r){let n=tt(e.type.schema).header_cell;for(let o=0;o<t.height;o++)if(e.nodeAt(t.map[r+o*t.width]).type!=n)return!1;return!0})(e,n,o+l)&&(l=0==o||o==e.width?null:0);for(let i=0;i<e.height;i++){let s=i*e.width+o;if(o>0&&o<e.width&&e.map[s-1]==e.map[s]){let l=e.map[s],a=n.nodeAt(l);t.setNodeMarkup(t.mapping.map(r+l),null,ht(a.attrs,o-e.colCount(l))),i+=a.attrs.rowspan-1}else{let a=null==l?tt(n.type.schema).cell:n.nodeAt(e.map[s+l]).type,p=e.positionAt(i,o,n);t.insert(t.mapping.map(r+p),a.createAndFill())}}return t}function It(t,{map:e,table:r,tableStart:n},o){let l=t.mapping.maps.length;for(let i=0;i<e.height;){let s=i*e.width+o,a=e.map[s],p=r.nodeAt(a);if(o>0&&e.map[s-1]==a||o<e.width-1&&e.map[s+1]==a)t.setNodeMarkup(t.mapping.slice(l).map(n+a),null,pt(p.attrs,o-e.colCount(a)));else{let e=t.mapping.slice(l).map(n+a);t.delete(e,e+p.nodeSize)}i+=p.attrs.rowspan}}function Ft(t,{map:e,tableStart:r,table:n},o){let l=r;for(let t=0;t<o;t++)l+=n.child(t).nodeSize;let i=[],s=o>0?-1:0;(function(t,e,r){let n=tt(e.type.schema).header_cell;for(let o=0;o<t.width;o++)if(e.nodeAt(t.map[o+r*t.width]).type!=n)return!1;return!0})(e,n,o+s)&&(s=0==o||o==e.height?null:0);for(let l=0,a=e.width*o;l<e.width;l++,a++)if(o>0&&o<e.height&&e.map[a]==e.map[a-e.width]){let o=e.map[a],i=n.nodeAt(o).attrs;t.setNodeMarkup(r+o,null,at(i,"rowspan",i.rowspan+1)),l+=i.colspan-1}else{let t=null==s?tt(n.type.schema).cell:n.nodeAt(e.map[a+s*e.width]).type;i.push(t.createAndFill())}return t.insert(l,tt(n.type.schema).row.create(null,i)),t}function Dt(t,{map:e,table:r,tableStart:n},o){let l=0;for(let t=0;t<o;t++)l+=r.child(t).nodeSize;let i=l+r.child(o).nodeSize,s=t.mapping.maps.length;t.delete(l+n,i+n);for(let l=0,i=o*e.width;l<e.width;l++,i++){let a=e.map[i];if(o>0&&a==e.map[i-e.width]){let e=r.nodeAt(a).attrs;t.setNodeMarkup(t.mapping.slice(s).map(a+n),null,at(e,"rowspan",e.rowspan-1)),l+=e.colspan-1}else if(o<e.width&&a==e.map[i+e.width]){let i=r.nodeAt(a),p=i.type.create(at(i.attrs,"rowspan",i.attrs.rowspan-1),i.content),h=e.positionAt(o+1,l,r);t.insert(t.mapping.slice(s).map(n+h),p),l+=i.attrs.colspan-1}}}function Yt(t){let e=t.content;return 1==e.childCount&&e.firstChild.isTextblock&&0==e.firstChild.childCount}function Bt(t,e){let r=t.selection;if(!(r instanceof ct)||r.$anchorCell.pos==r.$headCell.pos)return!1;let n=Ht(t),{map:o}=n;if(function({width:t,height:e,map:r},n){let o=n.top*t+n.left,l=o,i=(n.bottom-1)*t+n.left,s=o+(n.right-n.left-1);for(let e=n.top;e<n.bottom;e++){if(n.left>0&&r[l]==r[l-1]||n.right<t&&r[s]==r[s+1])return!0;l+=t,s+=t}for(let l=n.left;l<n.right;l++){if(n.top>0&&r[o]==r[o-t]||n.bottom<e&&r[i]==r[i+t])return!0;o++,i++}return!1}(o,n))return!1;if(e){let r,i,s=t.tr,a={},p=l.HY.empty;for(let t=n.top;t<n.bottom;t++)for(let e=n.left;e<n.right;e++){let l=o.map[t*o.width+e],h=n.table.nodeAt(l);if(!a[l])if(a[l]=!0,null==r)r=l,i=h;else{Yt(h)||(p=p.append(h.content));let t=s.mapping.map(l+n.tableStart);s.delete(t,t+h.nodeSize)}}if(s.setNodeMarkup(r+n.tableStart,null,at(ht(i.attrs,i.attrs.colspan,n.right-n.left-i.attrs.colspan),"rowspan",n.bottom-n.top)),p.size){let t=r+1+i.content.size,e=Yt(i)?r+1:t;s.replaceWith(e+n.tableStart,t+n.tableStart,p)}s.setSelection(new ct(s.doc.resolve(r+n.tableStart))),e(s)}return!0}function Jt(t,e){const r=tt(t.schema);return(n=({node:t})=>r[t.type.spec.tableRole],(t,e)=>{let r,o,l=t.selection;if(l instanceof ct){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,o=l.$anchorCell.pos}else{if(r=function(t){for(let e=t.depth;e>0;e--){const r=t.node(e).type.spec.tableRole;if("cell"===r||"header_cell"===r)return t.node(e)}return null}(l.$from),!r)return!1;o=rt(l.$from).pos}if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(e){let i=r.attrs,s=[],a=i.colwidth;i.rowspan>1&&(i=at(i,"rowspan",1)),i.colspan>1&&(i=at(i,"colspan",1));let p,h=Ht(t),c=t.tr;for(let t=0;t<h.right-h.left;t++)s.push(a?at(i,"colwidth",a&&a[t]?[a[t]]:null):i);for(let t=h.top;t<h.bottom;t++){let e=h.map.positionAt(t,h.left,h.table);t==h.top&&(e+=r.nodeSize);for(let o=h.left,l=0;o<h.right;o++,l++)o==h.left&&t==h.top||c.insert(p=c.mapping.map(e+h.tableStart,1),n({node:r,row:t,col:o}).createAndFill(s[l]))}c.setNodeMarkup(o,n({node:r,row:h.top,col:h.left}),s[0]),l instanceof ct&&c.setSelection(new ct(c.doc.resolve(l.$anchorCell.pos),p&&c.doc.resolve(p))),e(c)}return!0})(t,e);var n}function Lt(t,e,r){const n=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let t=0;t<n.length;t++){const o=e.table.nodeAt(n[t]);if(o&&o.type!==r.header_cell)return!1}return!0}function Wt(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,r){if(!nt(e))return!1;if(r){let n=tt(e.schema),o=Ht(e),l=e.tr,i=o.map.cellsInRect("column"==t?new G(o.left,0,o.right,o.map.height):"row"==t?new G(0,o.top,o.map.width,o.bottom):o),s=i.map((t=>o.table.nodeAt(t)));for(let t=0;t<i.length;t++)s[t].type==n.header_cell&&l.setNodeMarkup(o.tableStart+i[t],n.cell,s[t].attrs);if(0==l.steps.length)for(let t=0;t<i.length;t++)l.setNodeMarkup(o.tableStart+i[t],n.header_cell,s[t].attrs);r(l)}return!0}}(t):function(e,r){if(!nt(e))return!1;if(r){let n=tt(e.schema),o=Ht(e),l=e.tr,i=Lt("row",o,n),s=Lt("column",o,n),a=("column"===t?i:"row"===t&&s)?1:0,p="column"==t?new G(0,a,1,o.map.height):"row"==t?new G(a,0,o.map.width,1):o,h="column"==t?s?n.cell:n.header_cell:"row"==t?i?n.cell:n.header_cell:n.cell;o.map.cellsInRect(p).forEach((t=>{const e=t+o.tableStart,r=l.doc.nodeAt(e);r&&l.setNodeMarkup(e,h,r.attrs)})),r(l)}return!0}}Wt("row",{useDeprecatedLogic:!0}),Wt("column",{useDeprecatedLogic:!0});let _t=Wt("cell",{useDeprecatedLogic:!0});function Kt(t){return function(e,r){if(!nt(e))return!1;let n=function(t,e){if(e<0){let e=t.nodeBefore;if(e)return t.pos-e.nodeSize;for(let e=t.index(-1)-1,r=t.before();e>=0;e--){let n=t.node(-1).child(e);if(n.childCount)return r-1-n.lastChild.nodeSize;r-=n.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;let e=t.node(-1);for(let r=t.indexAfter(-1),n=t.after();r<e.childCount;r++){let t=e.child(r);if(t.childCount)return n+1;n+=t.nodeSize}}}(ot(e),t);if(null!=n){if(r){let t=e.doc.resolve(n);r(e.tr.setSelection(o.Bs.between(t,(l=t,l.node(0).resolve(l.pos+l.nodeAfter.nodeSize)))).scrollIntoView())}var l;return!0}}}class jt{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Pt(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,Pt(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}}function Pt(t,e,r,n,o,l){let i=0,s=!0,a=e.firstChild,p=t.firstChild;for(let t=0,r=0;t<p.childCount;t++){let{colspan:h,colwidth:c}=p.child(t).attrs;for(let t=0;t<h;t++,r++){let p=o==r?l:c&&c[t],h=p?p+"px":"";i+=p||n,p||(s=!1),a?(a.style.width!=h&&(a.style.width=h),a=a.nextSibling):e.appendChild(document.createElement("col")).style.width=h}}for(;a;){let t=a.nextSibling;a.parentNode.removeChild(a),a=t}s?(r.style.width=i+"px",r.style.minWidth=""):(r.style.width="",r.style.minWidth=i+"px")}const qt=new o.H$("tableColumnResizing");function Vt({handleWidth:t=5,cellMinWidth:e=25,View:r=jt,lastColumnResizable:n=!0}={}){let l=new o.Sy({key:qt,state:{init(t,n){return this.spec.props.nodeViews[tt(n.schema).table.name]=(t,n)=>new r(t,e,n),new Ut(-1,!1)},apply(t,e){return e.apply(t)}},props:{attributes(t){return qt.getState(t).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove(e,r){!function(t,e,r,n,o){let l=qt.getState(t.state);if(!l.dragging){let n=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target),i=-1;if(n){let{left:o,right:l}=n.getBoundingClientRect();e.clientX-o<=r?i=Xt(t,e,"left"):l-e.clientX<=r&&(i=Xt(t,e,"right"))}if(i!=l.activeHandle){if(!o&&-1!==i){let e=t.state.doc.resolve(i),r=e.node(-1),n=Q.get(r),o=e.start(-1);if(n.colCount(e.pos-o)+e.nodeAfter.attrs.colspan-1==n.width-1)return}Qt(t,i)}}}(e,r,t,0,n)},mouseleave(t){!function(t){let e=qt.getState(t.state);e.activeHandle>-1&&!e.dragging&&Qt(t,-1)}(t)},mousedown(t,r){!function(t,e,r){let n=qt.getState(t.state);if(-1==n.activeHandle||n.dragging)return!1;let o=t.state.doc.nodeAt(n.activeHandle),l=function(t,e,{colspan:r,colwidth:n}){let o=n&&n[n.length-1];if(o)return o;let l=t.domAtPos(e),i=l.node.childNodes[l.offset].offsetWidth,s=r;if(n)for(let t=0;t<r;t++)n[t]&&(i-=n[t],s--);return i/s}(t,n.activeHandle,o.attrs);function i(e){window.removeEventListener("mouseup",i),window.removeEventListener("mousemove",s);let n=qt.getState(t.state);n.dragging&&(!function(t,e,r){let n=t.state.doc.resolve(e),o=n.node(-1),l=Q.get(o),i=n.start(-1),s=l.colCount(n.pos-i)+n.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let t=0;t<l.height;t++){let e=t*l.width+s;if(t&&l.map[e]==l.map[e-l.width])continue;let n=l.map[e],{attrs:p}=o.nodeAt(n),h=1==p.colspan?0:s-l.colCount(n);if(p.colwidth&&p.colwidth[h]==r)continue;let c=p.colwidth?p.colwidth.slice():Zt(p.colspan);c[h]=r,a.setNodeMarkup(i+n,null,at(p,"colwidth",c))}a.docChanged&&t.dispatch(a)}(t,n.activeHandle,Gt(n.dragging,e,r)),t.dispatch(t.state.tr.setMeta(qt,{setDragging:null})))}function s(e){if(!e.which)return i(e);let n=qt.getState(t.state),o=Gt(n.dragging,e,r);!function(t,e,r,n){let o=t.state.doc.resolve(e),l=o.node(-1),i=o.start(-1),s=Q.get(l).colCount(o.pos-i)+o.nodeAfter.attrs.colspan-1,a=t.domAtPos(o.start(-1)).node;for(;"TABLE"!=a.nodeName;)a=a.parentNode;Pt(l,a.firstChild,a,n,s,r)}(t,n.activeHandle,o,r)}t.dispatch(t.state.tr.setMeta(qt,{setDragging:{startX:e.clientX,startWidth:l}})),window.addEventListener("mouseup",i),window.addEventListener("mousemove",s),e.preventDefault()}(t,r,e)}},decorations(t){let e=qt.getState(t);if(e.activeHandle>-1)return function(t,e){let r=[],n=t.doc.resolve(e),o=n.node(-1),l=Q.get(o),s=n.start(-1),a=l.colCount(n.pos-s)+n.nodeAfter.attrs.colspan;for(let t=0;t<l.height;t++){let e=a+t*l.width-1;if(!(a!=l.width&&l.map[e]==l.map[e+1]||0!=t&&l.map[e-1]==l.map[e-1-l.width])){let t=l.map[e],n=s+t+o.nodeAt(t).nodeSize-1,a=document.createElement("div");a.className="column-resize-handle",r.push(i.p.widget(n,a))}}return i.EH.create(t.doc,r)}(t,e.activeHandle)},nodeViews:{}}});return l}class Ut{constructor(t,e){this.activeHandle=t,this.dragging=e}apply(t){let e=this,r=t.getMeta(qt);if(r&&null!=r.setHandle)return new Ut(r.setHandle,null);if(r&&void 0!==r.setDragging)return new Ut(e.activeHandle,r.setDragging);if(e.activeHandle>-1&&t.docChanged){let r=t.mapping.map(e.activeHandle,-1);lt(t.doc.resolve(r))||(r=null),e=new Ut(r,e.dragging)}return e}}function Xt(t,e,r){let n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return-1;let{pos:o}=n,l=rt(t.state.doc.resolve(o));if(!l)return-1;if("right"==r)return l.pos;let i=Q.get(l.node(-1)),s=l.start(-1),a=i.map.indexOf(l.pos-s);return a%i.width==0?-1:s+i.map[a-1]}function Gt(t,e,r){let n=e.clientX-t.startX;return Math.max(r,t.startWidth+n)}function Qt(t,e){t.dispatch(t.state.tr.setMeta(qt,{setHandle:e}))}function Zt(t){let e=[];for(let r=0;r<t;r++)e.push(0);return e}function te({allowTableNodeSelection:t=!1}={}){return new o.Sy({key:et,state:{init(){return null},apply(t,e){let r=t.getMeta(et);if(null!=r)return-1==r?null:r;if(null==e||!t.docChanged)return e;let{deleted:n,pos:o}=t.mapping.mapResult(e);return n?null:o}},props:{decorations:ft,handleDOMEvents:{mousedown:Nt},createSelectionBetween(t){if(null!=et.getState(t.state))return t.state.selection},handleTripleClick:At,handleKeyDown:bt,handlePaste:Mt},appendTransaction(e,r,n){return function(t,e,r){let n,l,i=(e||t).selection,s=(e||t).doc;if(i instanceof o.qv&&(l=i.node.type.spec.tableRole)){if("cell"==l||"header_cell"==l)n=ct.create(s,i.from);else if("row"==l){let t=s.resolve(i.from+1);n=ct.rowSelection(t,t)}else if(!r){let t=Q.get(i.node),e=i.from+1,r=e+t.map[t.width*t.height-1];n=ct.create(s,e+1,r)}}else i instanceof o.Bs&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let r=t.pos,n=e.pos,o=t.depth;for(;o>=0&&!(t.after(o+1)<t.end(o));o--,r++);for(let t=e.depth;t>=0&&!(e.before(t+1)>e.start(t));t--,n--);return r==n&&/row|table/.test(t.node(o).type.spec.tableRole)}(i)?n=o.Bs.create(s,i.from):i instanceof o.Bs&&function({$from:t,$to:e}){let r,n;for(let e=t.depth;e>0;e--){let n=t.node(e);if("cell"===n.type.spec.tableRole||"header_cell"===n.type.spec.tableRole){r=n;break}}for(let t=e.depth;t>0;t--){let r=e.node(t);if("cell"===r.type.spec.tableRole||"header_cell"===r.type.spec.tableRole){n=r;break}}return r!==n&&0===e.parentOffset}(i)&&(n=o.Bs.create(s,i.$from.start(),i.$from.end()));return n&&(e||(e=t.tr)).setSelection(n),e}(n,zt(n,r),t)}})}function ee(t,e,r,n,o,l){let i=0,s=!0,a=e.firstChild;const p=t.firstChild;for(let t=0,r=0;t<p.childCount;t+=1){const{colspan:h,colwidth:c}=p.child(t).attrs;for(let t=0;t<h;t+=1,r+=1){const p=o===r?l:c&&c[t],h=p?`${p}px`:"";i+=p||n,p||(s=!1),a?(a.style.width!==h&&(a.style.width=h),a=a.nextSibling):e.appendChild(document.createElement("col")).style.width=h}}for(;a;){const t=a.nextSibling;a.parentNode.removeChild(a),a=t}s?(r.style.width=`${i}px`,r.style.minWidth=""):(r.style.width="",r.style.minWidth=`${i}px`)}class re{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ee(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type===this.node.type&&(this.node=t,ee(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"===t.type&&(t.target===this.table||this.colgroup.contains(t.target))}}function ne(t,e){return e?t.createChecked(null,e):t.createAndFill()}function oe(t,e,r,n,o){const l=function(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach((r=>{const n=t.nodes[r];n.spec.tableRole&&(e[n.spec.tableRole]=n)})),t.cached.tableNodeTypes=e,e}(t),i=[],s=[];for(let t=0;t<r;t+=1){const t=ne(l.cell,o);if(t&&s.push(t),n){const t=ne(l.header_cell,o);t&&i.push(t)}}const a=[];for(let t=0;t<e;t+=1)a.push(l.row.createChecked(null,n&&0===t?i:s));return l.table.createChecked(null,a)}const le=({editor:t})=>{const{selection:e}=t.state;if(!(e instanceof ct))return!1;let r=0;const o=(0,n.findParentNodeClosestToPos)(e.ranges[0].$from,(t=>"table"===t.type.name));null==o||o.node.descendants((t=>{if("table"===t.type.name)return!1;["tableCell","tableHeader"].includes(t.type.name)&&(r+=1)}));return r===e.ranges.length&&(t.commands.deleteTable(),!0)},ie=n.Node.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:re,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",(0,n.mergeAttributes)(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:r=!0}={})=>({tr:n,dispatch:l,editor:i})=>{const s=oe(i.schema,t,e,r);if(l){const t=n.selection.anchor+1;n.replaceSelectionWith(s).scrollIntoView().setSelection(o.Bs.near(n.doc.resolve(t)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>function(t,e){if(!nt(t))return!1;if(e){let r=Ht(t);e(Ot(t.tr,r,r.left))}return!0}(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>function(t,e){if(!nt(t))return!1;if(e){let r=Ht(t);e(Ot(t.tr,r,r.right))}return!0}(t,e),deleteColumn:()=>({state:t,dispatch:e})=>function(t,e){if(!nt(t))return!1;if(e){let r=Ht(t),n=t.tr;if(0==r.left&&r.right==r.map.width)return!1;for(let t=r.right-1;It(n,r,t),t!=r.left;t--)r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc,r.map=Q.get(r.table);e(n)}return!0}(t,e),addRowBefore:()=>({state:t,dispatch:e})=>function(t,e){if(!nt(t))return!1;if(e){let r=Ht(t);e(Ft(t.tr,r,r.top))}return!0}(t,e),addRowAfter:()=>({state:t,dispatch:e})=>function(t,e){if(!nt(t))return!1;if(e){let r=Ht(t);e(Ft(t.tr,r,r.bottom))}return!0}(t,e),deleteRow:()=>({state:t,dispatch:e})=>function(t,e){if(!nt(t))return!1;if(e){let r=Ht(t),n=t.tr;if(0==r.top&&r.bottom==r.map.height)return!1;for(let t=r.bottom-1;Dt(n,r,t),t!=r.top;t--)r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc,r.map=Q.get(r.table);e(n)}return!0}(t,e),deleteTable:()=>({state:t,dispatch:e})=>function(t,e){let r=t.selection.$anchor;for(let n=r.depth;n>0;n--)if("table"==r.node(n).type.spec.tableRole)return e&&e(t.tr.delete(r.before(n),r.after(n)).scrollIntoView()),!0;return!1}(t,e),mergeCells:()=>({state:t,dispatch:e})=>Bt(t,e),splitCell:()=>({state:t,dispatch:e})=>Jt(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>Wt("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>Wt("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>_t(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>!!Bt(t,e)||Jt(t,e),setCellAttribute:(t,e)=>({state:r,dispatch:n})=>function(t,e){return function(r,n){if(!nt(r))return!1;let o=ot(r);if(o.nodeAfter.attrs[t]===e)return!1;if(n){let l=r.tr;r.selection instanceof ct?r.selection.forEachCell(((r,n)=>{r.attrs[t]!==e&&l.setNodeMarkup(n,null,at(r.attrs,t,e))})):l.setNodeMarkup(o.pos,null,at(o.nodeAfter.attrs,t,e)),n(l)}return!0}}(t,e)(r,n),goToNextCell:()=>({state:t,dispatch:e})=>Kt(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Kt(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&zt(t),!0),setCellSelection:t=>({tr:e,dispatch:r})=>{if(r){const r=ct.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:le,"Mod-Backspace":le,Delete:le,"Mod-Delete":le}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Vt({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],te({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:(0,n.callOrReturn)((0,n.getExtensionField)(t,"tableRole",e))}}})}}]);
//# sourceMappingURL=67268.2d4d8bd15f3170f68a0f.min.js.map