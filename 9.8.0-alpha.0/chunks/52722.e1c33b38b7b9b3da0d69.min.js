/*! @patternslib/patternslib 9.7.0 */
"use strict";(self.webpackChunkploneintranet_patterns=self.webpackChunkploneintranet_patterns||[]).push([[52722],{52722:function(e,t,n){n.r(t),n.d(t,{History:function(){return k},default:function(){return k}});var r=n(19958),i=200,s=function(){};s.prototype.append=function(e){return e.length?(e=s.from(e),!this.length&&e||e.length<i&&this.leafAppend(e)||this.length<i&&e.leafPrepend(this)||this.appendInner(e)):this},s.prototype.prepend=function(e){return e.length?s.from(e).append(this):this},s.prototype.appendInner=function(e){return new p(this,e)},s.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?s.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},s.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},s.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},s.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(t,n){return r.push(e(t,n))}),t,n),r},s.from=function(e){return e instanceof s?e:e&&e.length?new o(e):s.empty};var o=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,r){for(var i=t;i<n;i++)if(!1===e(this.values[i],r+i))return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){for(var i=t-1;i>=n;i--)if(!1===e(this.values[i],r+i))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=i)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=i)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(s);s.empty=new o([]);var p=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,r){var i=this.left.length;return!(t<i&&!1===this.left.forEachInner(e,t,Math.min(n,i),r))&&(!(n>i&&!1===this.right.forEachInner(e,Math.max(t-i,0),Math.min(this.length,n)-i,r+i))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,r){var i=this.left.length;return!(t>i&&!1===this.right.forEachInvertedInner(e,t-i,Math.max(n,i)-i,r+i))&&(!(n<i&&!1===this.left.forEachInvertedInner(e,Math.min(t,i),n,r))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(s),h=s,a=n(16560),l=n(2376);class u{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,r,i=this.items.length;for(;;i--){if(this.items.get(i-1).selection){--i;break}}t&&(n=this.remapping(i,this.items.length),r=n.maps.length);let s,o,p=e.tr,h=[],a=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(i,t+1),r=n.maps.length),r--,void a.push(e);if(n){a.push(new f(e.map));let t,i=e.step.map(n.slice(r));i&&p.maybeStep(i).doc&&(t=p.mapping.maps[p.mapping.maps.length-1],h.push(new f(t,void 0,void 0,h.length+a.length))),r--,t&&n.appendMap(t,r)}else p.maybeStep(e.step);return e.selection?(s=n?e.selection.map(n.slice(r)):e.selection,o=new u(this.items.slice(0,i).append(a.reverse().concat(h)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:o,transform:p,selection:s}}addTransform(e,t,n,r){let i=[],s=this.eventCount,o=this.items,p=!r&&o.length?o.get(o.length-1):null;for(let n=0;n<e.steps.length;n++){let h,a=e.steps[n].invert(e.docs[n]),l=new f(e.mapping.maps[n],a,t);(h=p&&p.merge(l))&&(l=h,n?i.pop():o=o.slice(0,o.length-1)),i.push(l),t&&(s++,t=void 0),r||(p=l)}let h=s-n.depth;return h>d&&(o=function(e,t){let n;return e.forEach(((e,r)=>{if(e.selection&&0==t--)return n=r,!1})),e.slice(n)}(o,h),s-=h),new u(o.append(i),s)}remapping(e,t){let n=new a.vs;return this.items.forEach(((t,r)=>{let i=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,i)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new u(this.items.append(e.map((e=>new f(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),i=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach((e=>{e.selection&&o--}),r);let p=t;this.items.forEach((t=>{let r=i.getMirror(--p);if(null==r)return;s=Math.min(s,r);let h=i.maps[r];if(t.step){let s=e.steps[r].invert(e.docs[r]),a=t.selection&&t.selection.map(i.slice(p+1,r));a&&o++,n.push(new f(h,s,a))}else n.push(new f(h))}),r);let h=[];for(let e=t;e<s;e++)h.push(new f(i.maps[e]));let a=this.items.slice(0,r).append(h).append(n),l=new u(a,o);return l.emptyItemCount()>500&&(l=l.compress(this.items.length-n.length)),l}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],i=0;return this.items.forEach(((s,o)=>{if(o>=e)r.push(s),s.selection&&i++;else if(s.step){let e=s.step.map(t.slice(n)),o=e&&e.getMap();if(n--,o&&t.appendMap(o,n),e){let p=s.selection&&s.selection.map(t.slice(n));p&&i++;let h,a=new f(o.invert(),e,p),l=r.length-1;(h=r.length&&r[l].merge(a))?r[l]=h:r.push(a)}}else s.map&&n--}),this.items.length,0),new u(h.from(r.reverse()),i)}}u.empty=new u(h.empty,0);class f{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new f(t.getMap().invert(),t,this.selection)}}}class c{constructor(e,t,n,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r}}const d=20;function m(e){let t=[];return e.forEach(((e,n,r,i)=>t.push(r,i))),t}function g(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let i=t.map(e[r],1),s=t.map(e[r+1],-1);i<=s&&n.push(i,s)}return n}function v(e,t,n,r){let i=M(t),s=I.get(t).spec.config,o=(r?e.undone:e.done).popEvent(t,i);if(!o)return;let p=o.selection.resolve(o.transform.doc),h=(r?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),s,i),a=new c(r?h:o.remaining,r?o.remaining:h,null,0);n(o.transform.setSelection(p).setMeta(I,{redo:r,historyState:a}).scrollIntoView())}let y=!1,w=null;function M(e){let t=e.plugins;if(w!=t){y=!1,w=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){y=!0;break}}return y}const I=new l.H$("history"),E=new l.H$("closeHistory");function b(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new l.Sy({key:I,state:{init(){return new c(u.empty,u.empty,null,0)},apply(t,n,r){return function(e,t,n,r){let i,s=n.getMeta(I);if(s)return s.historyState;n.getMeta(E)&&(e=new c(e.done,e.undone,null,0));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(o&&o.getMeta(I))return o.getMeta(I).redo?new c(e.done.addTransform(n,void 0,r,M(t)),e.undone,m(n.mapping.maps[n.steps.length-1]),e.prevTime):new c(e.done,e.undone.addTransform(n,void 0,r,M(t)),null,e.prevTime);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(i=n.getMeta("rebased"))?new c(e.done.rebased(n,i),e.undone.rebased(n,i),g(e.prevRanges,n.mapping),e.prevTime):new c(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),g(e.prevRanges,n.mapping),e.prevTime);{let i=0==e.prevTime||!o&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,r)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&r>=t[i]&&(n=!0)})),n}(n,e.prevRanges)),s=o?g(e.prevRanges,n.mapping):m(n.mapping.maps[n.steps.length-1]);return new c(e.done.addTransform(n,i?t.selection.getBookmark():void 0,r,M(t)),u.empty,s,n.time)}}(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r="historyUndo"==n?C:"historyRedo"==n?T:null;return!!r&&(t.preventDefault(),r(e.state,e.dispatch))}}}})}const C=(e,t)=>{let n=I.getState(e);return!(!n||0==n.done.eventCount)&&(t&&v(n,e,t,!1),!0)},T=(e,t)=>{let n=I.getState(e);return!(!n||0==n.undone.eventCount)&&(t&&v(n,e,t,!0),!0)};const k=r.Extension.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>C(e,t),redo:()=>({state:e,dispatch:t})=>T(e,t)}},addProseMirrorPlugins(){return[b(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}})}}]);
//# sourceMappingURL=52722.e1c33b38b7b9b3da0d69.min.js.map