/*! @patternslib/patternslib 9.7.0 */
"use strict";(self.webpackChunkploneintranet_patterns=self.webpackChunkploneintranet_patterns||[]).push([[5126],{5126:function(e,t,n){n.r(t),n.d(t,{Gapcursor:function(){return m},default:function(){return m}});var r=n(19958),o=n(7327),i=n(2376),l=n(87823),s=n(84348);class a extends i.Y1{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return a.valid(n)?new a(n):i.Y1.near(n)}content(){return l.p2.empty}eq(e){return e instanceof a&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new a(e.resolve(t.pos))}getBookmark(){return new u(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(0!=n)for(let e=r.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n!=r.childCount)for(let e=r.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&a.valid(e))return e;let r=e.pos,o=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){o=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;r+=t;let l=e.doc.resolve(r);if(a.valid(l))return l}for(;;){let l=t>0?o.firstChild:o.lastChild;if(!l){if(o.isAtom&&!o.isText&&!i.qv.isSelectable(o)){e=e.doc.resolve(r+o.nodeSize*t),n=!1;continue e}break}o=l,r+=t;let s=e.doc.resolve(r);if(a.valid(s))return s}return null}}}a.prototype.visible=!1,a.findFrom=a.findGapCursorFrom,i.Y1.jsonID("gapcursor",a);class u{constructor(e){this.pos=e}map(e){return new u(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return a.valid(t)?new a(t):i.Y1.near(t)}}const c=(0,o.$)({ArrowLeft:d("horiz",-1),ArrowRight:d("horiz",1),ArrowUp:d("vert",-1),ArrowDown:d("vert",1)});function d(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,r,o){let l=e.selection,s=t>0?l.$to:l.$from,u=l.empty;if(l instanceof i.Bs){if(!o.endOfTextblock(n)||0==s.depth)return!1;u=!1,s=e.doc.resolve(t>0?s.after():s.before())}let c=a.findGapCursorFrom(s,t,u);return!!c&&(r&&r(e.tr.setSelection(new a(c))),!0)}}function p(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!a.valid(r))return!1;let o=e.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&i.qv.isSelectable(e.state.doc.nodeAt(o.inside)))&&(e.dispatch(e.state.tr.setSelection(new a(r))),!0)}function f(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof a))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let o=l.HY.empty;for(let e=r.length-1;e>=0;e--)o=l.HY.from(r[e].createAndFill(null,o));let s=e.state.tr.replace(n.pos,n.pos,new l.p2(o,0,0));return s.setSelection(i.Bs.near(s.doc.resolve(n.pos+1))),e.dispatch(s),!1}function h(e){if(!(e.selection instanceof a))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",s.EH.create(e.doc,[s.p.widget(e.selection.head,t,{key:"gapcursor"})])}const m=r.Extension.create({name:"gapCursor",addProseMirrorPlugins(){return[new i.Sy({props:{decorations:h,createSelectionBetween(e,t,n){return t.pos==n.pos&&a.valid(n)?new a(n):null},handleClick:p,handleKeyDown:c,handleDOMEvents:{beforeinput:f}}})]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:null!==(t=(0,r.callOrReturn)((0,r.getExtensionField)(e,"allowGapCursor",n)))&&void 0!==t?t:null}}})}}]);
//# sourceMappingURL=5126.bd02ccc6ada7b5a03844.min.js.map