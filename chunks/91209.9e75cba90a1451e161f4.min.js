"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[91209,84193],{22383:function(e,t,n){n.d(t,{y:function(){return c},z:function(){return d}});var a=n(86272),i=n(56938),r=n(57467),o=n(45814),s=n(92114);let l=null;async function c(e){let{url:t,editor:n,instance:c=null,pattern:u=null,extra_class:p=null}=e;const m=l,v=l=n.state.doc.nodeAt(n.state.selection.from);if(null===c||v===m&&c?.tippy.popperInstance||(await d({instance:c,pattern_name:u.name}),c=null),c&&c?.tippy.popperInstance)c.get_content(t);else{u&&(a.Z.patterns[u.name]=u);const e=n.options.element;c=await new o.ZP(e,{source:"ajax",url:t,trigger:"none",class:p,"position-list":["tl"]}),await r.Z.await_pattern_init(c);const l=(0,s.posToDOMRect)(n.view,n.state.selection.from,n.state.selection.to);c.tippy?.setProps({getReferenceClientRect:()=>l}),r.Z.add_event_listener(document,"mousedown","tiptap--context_menu_close--click",(async e=>{[e.target,...i.Z.get_parents(e.target)].includes(c?.tippy.popper)||(await d({instance:c,pattern_name:u.name}),c=null)})),r.Z.add_event_listener(document,"keydown","tiptap--context_menu_close--esc",(async e=>{"Escape"===e.key&&(await d({instance:c,pattern_name:u.name}),c=null)})),c.show()}return c}async function d(e){let{instance:t,pattern_name:n}=e;return t&&(await t.hide(),t.destroy(),t=null),n&&delete a.Z.patterns[n],r.Z.remove_event_listener(document,"tiptap--context_menu_close--click"),r.Z.remove_event_listener(document,"tiptap--context_menu_close--esc"),null}},91209:function(e,t,n){n.r(t),n.d(t,{factory:function(){return y}});var a=n(92114),i=n(2376),r=n(84348);const o=new i.H$("suggestion");function s({pluginKey:e=o,editor:t,char:n="@",allowSpaces:s=!1,allowedPrefixes:l=[" "],startOfLine:c=!1,decorationTag:d="span",decorationClass:u="suggestion",command:p=(()=>null),items:m=(()=>[]),render:v=(()=>({})),allow:g=(()=>!0)}){let f;const h=null==v?void 0:v(),y=new i.Sy({key:e,view(){return{update:async(e,n)=>{var a,i,r,o,s,l,c;const d=null===(a=this.key)||void 0===a?void 0:a.getState(n),u=null===(i=this.key)||void 0===i?void 0:i.getState(e.state),v=d.active&&u.active&&d.range.from!==u.range.from,g=!d.active&&u.active,y=d.active&&!u.active,w=g||v,b=!g&&!y&&d.query!==u.query&&!v,_=y||v;if(!w&&!b&&!_)return;const x=_&&!w?d:u,$=e.dom.querySelector(`[data-decoration-id="${x.decorationId}"]`);f={editor:t,range:x.range,query:x.query,text:x.text,items:[],command:e=>{p({editor:t,range:x.range,props:e})},decorationNode:$,clientRect:$?()=>{var n;const{decorationId:a}=null===(n=this.key)||void 0===n?void 0:n.getState(t.state),i=e.dom.querySelector(`[data-decoration-id="${a}"]`);return(null==i?void 0:i.getBoundingClientRect())||null}:null},w&&(null===(r=null==h?void 0:h.onBeforeStart)||void 0===r||r.call(h,f)),b&&(null===(o=null==h?void 0:h.onBeforeUpdate)||void 0===o||o.call(h,f)),(b||w)&&(f.items=await m({editor:t,query:x.query})),_&&(null===(s=null==h?void 0:h.onExit)||void 0===s||s.call(h,f)),b&&(null===(l=null==h?void 0:h.onUpdate)||void 0===l||l.call(h,f)),w&&(null===(c=null==h?void 0:h.onStart)||void 0===c||c.call(h,f))},destroy:()=>{var e;f&&(null===(e=null==h?void 0:h.onExit)||void 0===e||e.call(h,f))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(e,i,r,o){const{isEditable:d}=t,{composing:u}=t.view,{selection:p}=e,{empty:m,from:v}=p,f={...i};if(f.composing=u,d&&(m||t.view.composing)){!(v<i.range.from||v>i.range.to)||u||i.composing||(f.active=!1);const e=function(e){var t;const{char:n,allowSpaces:i,allowedPrefixes:r,startOfLine:o,$position:s}=e,l=(0,a.escapeForRegEx)(n),c=new RegExp(`\\s${l}$`),d=o?"^":"",u=i?new RegExp(`${d}${l}.*?(?=\\s${l}|$)`,"gm"):new RegExp(`${d}(?:^)?${l}[^\\s${l}]*`,"gm"),p=(null===(t=s.nodeBefore)||void 0===t?void 0:t.isText)&&s.nodeBefore.text;if(!p)return null;const m=s.pos-p.length,v=Array.from(p.matchAll(u)).pop();if(!v||void 0===v.input||void 0===v.index)return null;const g=v.input.slice(Math.max(0,v.index-1),v.index),f=new RegExp(`^[${null==r?void 0:r.join("")}\0]?$`).test(g);if(null!==r&&!f)return null;const h=m+v.index;let y=h+v[0].length;return i&&c.test(p.slice(y-1,y+1))&&(v[0]+=" ",y+=1),h<s.pos&&y>=s.pos?{range:{from:h,to:y},query:v[0].slice(n.length),text:v[0]}:null}({char:n,allowSpaces:s,allowedPrefixes:l,startOfLine:c,$position:p.$from}),r=`id_${Math.floor(4294967295*Math.random())}`;e&&g({editor:t,state:o,range:e.range})?(f.active=!0,f.decorationId=i.decorationId?i.decorationId:r,f.range=e.range,f.query=e.query,f.text=e.text):f.active=!1}else f.active=!1;return f.active||(f.decorationId=null,f.range={from:0,to:0},f.query=null,f.text=null),f}},props:{handleKeyDown(e,t){var n;const{active:a,range:i}=y.getState(e.state);return a&&(null===(n=null==h?void 0:h.onKeyDown)||void 0===n?void 0:n.call(h,{view:e,event:t,range:i}))||!1},decorations(e){const{active:t,range:n,decorationId:a}=y.getState(e);return t?r.EH.create(e.doc,[r.p.inline(n.from,n.to,{nodeName:d,class:u,"data-decoration-id":a})]):null}}});return y}var l=n(22383),c=n(84193),d=n(92041),u=n(56938),p=n(57467),m=n(92452),v=n(34095);function g(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let f;function h(e,t){class n extends d.o{init(){(0,c.focus_handler)(this.el),this.active=this.items[0],p.Z.add_event_listener(this.el,"keydown","tiptap-suggestion-keydown",(e=>{e.preventDefault(),e.stopPropagation();const t=this.items,n=this.active;if("ArrowDown"===e.code)if(n){let e=n?t.indexOf(n)+1:0;e>=t.length&&(e=0),this.active=t[e]}else this.active=t[0];else if("ArrowUp"===e.code)if(n){let e=n?t.indexOf(n)-1:0;e<0&&(e=t.length-1),this.active=t[e]}else this.active=t[0];else if("Enter"===e.code){const e=n?.dataset?.tiptapValue;if(!e)return;const t=n.querySelector("a");this.command(t,e)}})),p.Z.add_event_listener(this.el,"click","tiptap-suggestion-click",(e=>{const t=e.target.closest("a"),n=u.Z.acquire_attribute(t,"data-tiptap-value");n&&(e.preventDefault(),this.command(t,n))}))}command(e,n){const a=Object.fromEntries([...e.attributes].map((e=>[e.name,e.value])));t.command({"data-title":n,...a})}get active(){return this.el.querySelector(".tiptap-item.active")}set active(e){e&&(this.active?.classList.remove("active"),e.classList.add("active"))}get items(){return[...this.el.querySelectorAll(".tiptap-item")]}}return g(n,"name","tiptap-suggestion"),g(n,"trigger",".tiptap-items"),n}const y=e=>{let{app:t,name:n,char:r,plural:o}=e;return a.Node.create({name:n,content:"inline*",group:"inline",inline:!0,selectable:!1,atom:!0,isolating:!0,addOptions(){return{HTMLAttributes:{},url:null,renderLabel(e){let{options:t,node:n}=e;const a=(n.attrs["data-title"]||n.content?.content?.[0]?.text||"").replace(new RegExp(`^${t.suggestion.char}`),"");return`${t.suggestion.char}${a}`},suggestion:{char:r,pluginKey:new i.H$(n)}}},addAttributes(){const e={class:{},contenteditable:{},href:{},target:{},title:{},"data-id":{},"data-title":{},"data-pat-inject":{},"data-pat-forward":{},"data-pat-modal":{},"data-pat-switch":{},"data-pat-toggle":{},"data-pat-tooltip":{}};e[`data-${this.name}`]={default:""};for(const t of v.ZP.accessibility_attributes)e[t]={};return e},parseHTML(){return[{tag:`a[data-${this.name}]`}]},renderHTML(e){let{node:t,HTMLAttributes:n}=e;return["a",(0,a.mergeAttributes)(this.options.HTMLAttributes,n),this.options.renderLabel({options:this.options,node:t})]},renderText(e){let{node:t}=e;return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Enter:()=>!!f&&(f.tippy?.popper?.querySelector(".tiptap-items")?.dispatchEvent(new KeyboardEvent("keydown",{code:"Enter"})),!0),Backspace:e=>{let{editor:t}=e;return t.commands.command((e=>{let{tr:t,state:n}=e,a=!1;const{selection:i}=n,{empty:r,anchor:o}=i;return!!r&&(n.doc.nodesBetween(o-1,o,((e,n)=>{if(e.type.name===this.name)return a=!0,t.insertText(this.options.suggestion.char||"",n,n+e.nodeSize),!1})),a)}))}}},addProseMirrorPlugins(){var e=this;return this.options.suggestion.command=e=>{let{editor:t,range:n,props:a}=e;n.to=t.state.selection.$head.pos,t.chain().focus().insertContentAt(n,[{type:this.name,attrs:a},{type:"text",text:" "}]).run()},this.options.suggestion.render=()=>{let t;const n=async()=>{this.editor.off("selectionUpdate",t),await(0,l.z)({instance:f,pattern_name:"tiptap-suggestion"}),f=null};return{onStart:async n=>{const a=async function(){let{transaction:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{transaction:null},a=e.options.url,i=n.range.from+1,r=t?t.curSelection.$head.pos:n.range.to;const s=e.editor.state.doc.textBetween(i,r,"");a=s?a+s:a;const c=await(0,l.y)({url:a,editor:e.editor,instance:f,pattern:h(0,n),extra_class:`tiptap-${o||e.name}`});return c};t=m.Z.debounce((async e=>{f=await a(e)}),200),f=await a(),this.editor.on("selectionUpdate",t)},onKeyDown:e=>{if(f&&("ArrowDown"===e.event.key||"ArrowUp"===e.event.key||"Enter"===e.event.key)){e.event.preventDefault(),e.event.stopPropagation();const t=document.querySelector(".tiptap-items");if(!t)return;t.dispatchEvent(new KeyboardEvent("keydown",{code:e.event.key}))}},onExit:()=>{n()}}},this.options.suggestion.allow=e=>{let{state:t,range:n}=e;const a=t.doc.resolve(n.from),i=t.schema.nodes[this.name];return!!a.parent.type.contentMatch.matchType(i)},[s({editor:this.editor,...this.options.suggestion})]}})}},84193:function(e,t,n){n.r(t),n.d(t,{TARGETS:function(){return r},focus_handler:function(){return o}});var a=n(57467),i=n(92452);const r=[];function o(e){e.setAttribute("tabindex","-1"),a.Z.add_event_listener(e,"focus","tiptap-focusin",(async()=>{i.Z.timeout(1),r.map((e=>e?.classList.add("tiptap-focus")))}),!0),a.Z.add_event_listener(e,"blur","tiptap-focusout",(()=>{r.map((e=>e?.classList.remove("tiptap-focus")))}),!0)}},34095:function(e,t,n){t.ZP={add_search_params:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new URL(e,window.location.href);return`${n.origin}${n.pathname}?${new URLSearchParams([...Array.from(n.searchParams.entries()),...Object.entries(t)]).toString()}`},accessibility_attributes:["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-controls","aria-describedby","aria-disabled","aria-dropeffect","aria-expanded","aria-flowto","aria-grabbed","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","role"],is_url:e=>/(^\.?\.?\/|:\/\/)/.test(e)}}}]);
//# sourceMappingURL=91209.9e75cba90a1451e161f4.min.js.map