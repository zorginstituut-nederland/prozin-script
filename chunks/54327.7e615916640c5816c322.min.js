"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[54327],{54327:function(e,t,l){l.r(t),l.d(t,{Table:function(){return ye},createTable:function(){return be},default:function(){return ye}});var o=l(92114),n=l(2376),r=l(87823),i=l(7327),a=l(84348),s=l(16560);let c,d;if("undefined"!=typeof WeakMap){let e=new WeakMap;c=t=>e.get(t),d=(t,l)=>(e.set(t,l),l)}else{let e=[],t=10,l=0;c=t=>{for(let l=0;l<e.length;l+=2)if(e[l]==t)return e[l+1]},d=(o,n)=>(l==t&&(l=0),e[l++]=o,e[l++]=n)}class h{constructor(e,t,l,o){this.left=e,this.top=t,this.right=l,this.bottom=o}}class p{constructor(e,t,l,o){this.width=e,this.height=t,this.map=l,this.problems=o}findCell(e){for(let t=0;t<this.map.length;t++){let l=this.map[t];if(l!=e)continue;let o=t%this.width,n=t/this.width|0,r=o+1,i=n+1;for(let e=1;r<this.width&&this.map[t+e]==l;e++)r++;for(let e=1;i<this.height&&this.map[t+this.width*e]==l;e++)i++;return new h(o,n,r,i)}throw new RangeError("No cell with offset "+e+" found")}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError("No cell with offset "+e+" found")}nextCell(e,t,l){let{left:o,right:n,top:r,bottom:i}=this.findCell(e);return"horiz"==t?(l<0?0==o:n==this.width)?null:this.map[r*this.width+(l<0?o-1:n)]:(l<0?0==r:i==this.height)?null:this.map[o+this.width*(l<0?r-1:i)]}rectBetween(e,t){let{left:l,right:o,top:n,bottom:r}=this.findCell(e),{left:i,right:a,top:s,bottom:c}=this.findCell(t);return new h(Math.min(l,i),Math.min(n,s),Math.max(o,a),Math.max(r,c))}cellsInRect(e){let t=[],l={};for(let o=e.top;o<e.bottom;o++)for(let n=e.left;n<e.right;n++){let r=o*this.width+n,i=this.map[r];l[i]||(l[i]=!0,n==e.left&&n&&this.map[r-1]==i||o==e.top&&o&&this.map[r-this.width]==i||t.push(i))}return t}positionAt(e,t,l){for(let o=0,n=0;;o++){let r=n+l.child(o).nodeSize;if(o==e){let l=t+e*this.width,o=(e+1)*this.width;for(;l<o&&this.map[l]<n;)l++;return l==o?r-1:this.map[l]}n=r}}static get(e){return c(e)||d(e,function(e){if("table"!=e.type.spec.tableRole)throw new RangeError("Not a table node: "+e.type.name);let t=function(e){let t=-1,l=!1;for(let o=0;o<e.childCount;o++){let n=e.child(o),r=0;if(l)for(let t=0;t<o;t++){let l=e.child(t);for(let e=0;e<l.childCount;e++){let n=l.child(e);t+n.attrs.rowspan>o&&(r+=n.attrs.colspan)}}for(let e=0;e<n.childCount;e++){let t=n.child(e);r+=t.attrs.colspan,t.attrs.rowspan>1&&(l=!0)}-1==t?t=r:t!=r&&(t=Math.max(t,r))}return t}(e),l=e.childCount,o=[],n=0,r=null,i=[];for(let e=0,n=t*l;e<n;e++)o[e]=0;for(let a=0,s=0;a<l;a++){let c=e.child(a);s++;for(let e=0;;e++){for(;n<o.length&&0!=o[n];)n++;if(e==c.childCount)break;let d=c.child(e),{colspan:h,rowspan:p,colwidth:u}=d.attrs;for(let e=0;e<p;e++){if(e+a>=l){(r||(r=[])).push({type:"overlong_rowspan",pos:s,n:p-e});break}let c=n+e*t;for(let e=0;e<h;e++){0==o[c+e]?o[c+e]=s:(r||(r=[])).push({type:"collision",row:a,pos:s,n:h-e});let l=u&&u[e];if(l){let o=(c+e)%t*2,n=i[o];null==n||n!=l&&1==i[o+1]?(i[o]=l,i[o+1]=1):n==l&&i[o+1]++}}}n+=h,s+=d.nodeSize}let d=(a+1)*t,h=0;for(;n<d;)0==o[n++]&&h++;h&&(r||(r=[])).push({type:"missing",row:a,n:h}),s++}let a=new p(t,l,o,r),s=!1;for(let e=0;!s&&e<i.length;e+=2)null!=i[e]&&i[e+1]<l&&(s=!0);s&&function(e,t,l){e.problems||(e.problems=[]);for(let o=0,n={};o<e.map.length;o++){let r=e.map[o];if(n[r])continue;n[r]=!0;let i=l.nodeAt(r),a=null;for(let l=0;l<i.attrs.colspan;l++){let n=t[2*((o+l)%e.width)];null==n||i.attrs.colwidth&&i.attrs.colwidth[l]==n||((a||(a=u(i.attrs)))[l]=n)}a&&e.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}(a,i,e);return a}(e))}}function u(e){if(e.colwidth)return e.colwidth.slice();let t=[];for(let l=0;l<e.colspan;l++)t.push(0);return t}function f(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(let l in e.nodes){let o=e.nodes[l],n=o.spec.tableRole;n&&(t[n]=o)}}return t}const m=new n.H$("selectingCells");function w(e){for(let t=e.depth-1;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return e.node(0).resolve(e.before(t+1));return null}function g(e){let t=e.selection.$head;for(let e=t.depth;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return!0;return!1}function b(e){let t=e.selection;return t.$anchorCell?t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell:t.node&&"cell"==t.node.type.spec.tableRole?t.$anchor:w(t.$head)||function(e){for(let t=e.nodeAfter,l=e.pos;t;t=t.firstChild,l++){let o=t.type.spec.tableRole;if("cell"==o||"header_cell"==o)return e.doc.resolve(l)}for(let t=e.nodeBefore,l=e.pos;t;t=t.lastChild,l--){let o=t.type.spec.tableRole;if("cell"==o||"header_cell"==o)return e.doc.resolve(l-t.nodeSize)}}(t.$head)}function C(e){return"row"==e.parent.type.spec.tableRole&&e.nodeAfter}function y(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function v(e,t,l){let o=e.start(-1),n=p.get(e.node(-1)).nextCell(e.pos-o,t,l);return null==n?null:e.node(0).resolve(o+n)}function S(e,t,l){let o={};for(let t in e)o[t]=e[t];return o[t]=l,o}function A(e,t,l=1){let o=S(e,"colspan",e.colspan-l);return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(t,l),o.colwidth.some((e=>e>0))||(o.colwidth=null)),o}function $(e,t,l=1){let o=S(e,"colspan",e.colspan+l);if(o.colwidth){o.colwidth=o.colwidth.slice();for(let e=0;e<l;e++)o.colwidth.splice(t,0,0)}return o}class M extends n.Y1{constructor(e,t=e){let l=e.node(-1),o=p.get(l),r=e.start(-1),i=o.rectBetween(e.pos-r,t.pos-r),a=e.node(0),s=o.cellsInRect(i).filter((e=>e!=t.pos-r));s.unshift(t.pos-r);let c=s.map((e=>{let t=l.nodeAt(e),o=e+r+1;return new n.xm(a.resolve(o),a.resolve(o+t.content.size))}));super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=t}map(e,t){let l=e.resolve(t.map(this.$anchorCell.pos)),o=e.resolve(t.map(this.$headCell.pos));if(C(l)&&C(o)&&y(l,o)){let e=this.$anchorCell.node(-1)!=l.node(-1);return e&&this.isRowSelection()?M.rowSelection(l,o):e&&this.isColSelection()?M.colSelection(l,o):new M(l,o)}return n.Bs.between(l,o)}content(){let e=this.$anchorCell.node(-1),t=p.get(e),l=this.$anchorCell.start(-1),o=t.rectBetween(this.$anchorCell.pos-l,this.$headCell.pos-l),n={},i=[];for(let l=o.top;l<o.bottom;l++){let a=[];for(let r=l*t.width+o.left,i=o.left;i<o.right;i++,r++){let l=t.map[r];if(!n[l]){n[l]=!0;let r=t.findCell(l),i=e.nodeAt(l),s=o.left-r.left,c=r.right-o.right;if(s>0||c>0){let e=i.attrs;s>0&&(e=A(e,0,s)),c>0&&(e=A(e,e.colspan-c,c)),i=r.left<o.left?i.type.createAndFill(e):i.type.create(e,i.content)}if(r.top<o.top||r.bottom>o.bottom){let e=S(i.attrs,"rowspan",Math.min(r.bottom,o.bottom)-Math.max(r.top,o.top));i=r.top<o.top?i.type.createAndFill(e):i.type.create(e,i.content)}a.push(i)}}i.push(e.child(l).copy(r.HY.from(a)))}const a=this.isColSelection()&&this.isRowSelection()?e:i;return new r.p2(r.HY.from(a),1,1)}replace(e,t=r.p2.empty){let l=e.steps.length,o=this.ranges;for(let n=0;n<o.length;n++){let{$from:i,$to:a}=o[n],s=e.mapping.slice(l);e.replace(s.map(i.pos),s.map(a.pos),n?r.p2.empty:t)}let i=n.Y1.findFrom(e.doc.resolve(e.mapping.slice(l).map(this.to)),-1);i&&e.setSelection(i)}replaceWith(e,t){this.replace(e,new r.p2(r.HY.from(t),0,0))}forEachCell(e){let t=this.$anchorCell.node(-1),l=p.get(t),o=this.$anchorCell.start(-1),n=l.cellsInRect(l.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let l=0;l<n.length;l++)e(t.nodeAt(n[l]),o+n[l])}isColSelection(){let e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;let l=e+this.$anchorCell.nodeAfter.attrs.rowspan,o=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(l,o)==this.$headCell.node(-1).childCount}static colSelection(e,t=e){let l=p.get(e.node(-1)),o=e.start(-1),n=l.findCell(e.pos-o),r=l.findCell(t.pos-o),i=e.node(0);return n.top<=r.top?(n.top>0&&(e=i.resolve(o+l.map[n.left])),r.bottom<l.height&&(t=i.resolve(o+l.map[l.width*(l.height-1)+r.right-1]))):(r.top>0&&(t=i.resolve(o+l.map[r.left])),n.bottom<l.height&&(e=i.resolve(o+l.map[l.width*(l.height-1)+n.right-1]))),new M(e,t)}isRowSelection(){let e=p.get(this.$anchorCell.node(-1)),t=this.$anchorCell.start(-1),l=e.colCount(this.$anchorCell.pos-t),o=e.colCount(this.$headCell.pos-t);if(Math.min(l,o)>0)return!1;let n=l+this.$anchorCell.nodeAfter.attrs.colspan,r=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(n,r)==e.width}eq(e){return e instanceof M&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,t=e){let l=p.get(e.node(-1)),o=e.start(-1),n=l.findCell(e.pos-o),r=l.findCell(t.pos-o),i=e.node(0);return n.left<=r.left?(n.left>0&&(e=i.resolve(o+l.map[n.top*l.width])),r.right<l.width&&(t=i.resolve(o+l.map[l.width*(r.top+1)-1]))):(r.left>0&&(t=i.resolve(o+l.map[r.top*l.width])),n.right<l.width&&(e=i.resolve(o+l.map[l.width*(n.top+1)-1]))),new M(e,t)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,t){return new M(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,l=t){return new M(e.resolve(t),e.resolve(l))}getBookmark(){return new R(this.$anchorCell.pos,this.$headCell.pos)}}M.prototype.visible=!1,n.Y1.jsonID("cell",M);class R{constructor(e,t){this.anchor=e,this.head=t}map(e){return new R(e.map(this.anchor),e.map(this.head))}resolve(e){let t=e.resolve(this.anchor),l=e.resolve(this.head);return"row"==t.parent.type.spec.tableRole&&"row"==l.parent.type.spec.tableRole&&t.index()<t.parent.childCount&&l.index()<l.parent.childCount&&y(t,l)?new M(t,l):n.Y1.near(l,1)}}function N(e){if(!(e.selection instanceof M))return null;let t=[];return e.selection.forEachCell(((e,l)=>{t.push(a.p.node(l,l+e.nodeSize,{class:"selectedCell"}))})),a.EH.create(e.doc,t)}function x(e){if(!e.size)return null;let{content:t,openStart:l,openEnd:o}=e;for(;1==t.childCount&&(l>0&&o>0||"table"==t.firstChild.type.spec.tableRole);)l--,o--,t=t.firstChild.content;let n=t.firstChild,i=n.type.spec.tableRole,a=n.type.schema,s=[];if("row"==i)for(let e=0;e<t.childCount;e++){let n=t.child(e).content,i=e?0:Math.max(0,l-1),c=e<t.childCount-1?0:Math.max(0,o-1);(i||c)&&(n=z(f(a).row,new r.p2(n,i,c)).content),s.push(n)}else{if("cell"!=i&&"header_cell"!=i)return null;s.push(l||o?z(f(a).row,new r.p2(t,l,o)).content:t)}return function(e,t){let l=[];for(let e=0;e<t.length;e++){let o=t[e];for(let t=o.childCount-1;t>=0;t--){let{rowspan:n,colspan:r}=o.child(t).attrs;for(let t=e;t<e+n;t++)l[t]=(l[t]||0)+r}}let o=0;for(let e=0;e<l.length;e++)o=Math.max(o,l[e]);for(let n=0;n<l.length;n++)if(n>=t.length&&t.push(r.HY.empty),l[n]<o){let i=f(e).cell.createAndFill(),a=[];for(let e=l[n];e<o;e++)a.push(i);t[n]=t[n].append(r.HY.from(a))}return{height:t.length,width:o,rows:t}}(a,s)}function z(e,t){let l=e.createAndFill();return new s.wx(l).replace(0,l.content.size,t).doc}function k(e,t,l,o,n,r,i,a){if(0==i||i==t.height)return!1;let s=!1;for(let c=n;c<r;c++){let n=i*t.width+c,r=t.map[n];if(t.map[n-t.width]==r){s=!0;let n=l.nodeAt(r),{top:d,left:h}=t.findCell(r);e.setNodeMarkup(e.mapping.slice(a).map(r+o),null,S(n.attrs,"rowspan",i-d)),e.insert(e.mapping.slice(a).map(t.positionAt(i,h,l)),n.type.createAndFill(S(n.attrs,"rowspan",d+n.attrs.rowspan-i))),c+=n.attrs.colspan-1}}return s}function H(e,t,l,o,n,r,i,a){if(0==i||i==t.width)return!1;let s=!1;for(let c=n;c<r;c++){let n=c*t.width+i,r=t.map[n];if(t.map[n-1]==r){s=!0;let n=l.nodeAt(r),d=t.colCount(r),h=e.mapping.slice(a).map(r+o);e.setNodeMarkup(h,null,A(n.attrs,i-d,n.attrs.colspan-(i-d))),e.insert(h+n.nodeSize,n.type.createAndFill(A(n.attrs,0,i-d))),c+=n.attrs.rowspan-1}}return s}function E(e,t,l,o,n){let i=l?e.doc.nodeAt(l-1):e.doc,a=p.get(i),{top:s,left:c}=o,d=c+n.width,h=s+n.height,u=e.tr,m=0;function w(){i=l?u.doc.nodeAt(l-1):u.doc,a=p.get(i),m=u.mapping.maps.length}(function(e,t,l,o,n,i,a){let s,c,d=f(e.doc.type.schema);if(n>t.width)for(let r=0,i=0;r<t.height;r++){let h=l.child(r);i+=h.nodeSize;let p,u=[];p=null==h.lastChild||h.lastChild.type==d.cell?s||(s=d.cell.createAndFill()):c||(c=d.header_cell.createAndFill());for(let e=t.width;e<n;e++)u.push(p);e.insert(e.mapping.slice(a).map(i-1+o),u)}if(i>t.height){let h=[];for(let e=0,o=(t.height-1)*t.width;e<Math.max(t.width,n);e++){let n=!(e>=t.width)&&l.nodeAt(t.map[o+e]).type==d.header_cell;h.push(n?c||(c=d.header_cell.createAndFill()):s||(s=d.cell.createAndFill()))}let p=d.row.create(null,r.HY.from(h)),u=[];for(let e=t.height;e<i;e++)u.push(p);e.insert(e.mapping.slice(a).map(o+l.nodeSize-2),u)}return!(!s&&!c)})(u,a,i,l,d,h,m)&&w(),k(u,a,i,l,c,d,s,m)&&w(),k(u,a,i,l,c,d,h,m)&&w(),H(u,a,i,l,s,h,c,m)&&w(),H(u,a,i,l,s,h,d,m)&&w();for(let e=s;e<h;e++){let t=a.positionAt(e,c,i),o=a.positionAt(e,d,i);u.replace(u.mapping.slice(m).map(t+l),u.mapping.slice(m).map(o+l),new r.p2(n.rows[e-s],0,0))}w(),u.setSelection(new M(u.doc.resolve(l+a.positionAt(s,c,i)),u.doc.resolve(l+a.positionAt(h-1,d-1,i)))),t(u)}const T=(0,i.$)({ArrowLeft:D("horiz",-1),ArrowRight:D("horiz",1),ArrowUp:D("vert",-1),ArrowDown:D("vert",1),"Shift-ArrowLeft":W("horiz",-1),"Shift-ArrowRight":W("horiz",1),"Shift-ArrowUp":W("vert",-1),"Shift-ArrowDown":W("vert",1),Backspace:_,"Mod-Backspace":_,Delete:_,"Mod-Delete":_});function B(e,t,l){return!l.eq(e.selection)&&(t&&t(e.tr.setSelection(l).scrollIntoView()),!0)}function D(e,t){return(l,o,r)=>{let i=l.selection;if(i instanceof M)return B(l,o,n.Y1.near(i.$headCell,t));if("horiz"!=e&&!i.empty)return!1;let a=O(r,e,t);if(null==a)return!1;if("horiz"==e)return B(l,o,n.Y1.near(l.doc.resolve(i.head+t),t));{let r,i=l.doc.resolve(a),s=v(i,e,t);return r=s?n.Y1.near(s,1):t<0?n.Y1.near(l.doc.resolve(i.before(-1)),-1):n.Y1.near(l.doc.resolve(i.after(-1)),1),B(l,o,r)}}}function W(e,t){return(l,o,n)=>{let r=l.selection;if(!(r instanceof M)){let o=O(n,e,t);if(null==o)return!1;r=new M(l.doc.resolve(o))}let i=v(r.$headCell,e,t);return!!i&&B(l,o,new M(r.$anchorCell,i))}}function _(e,t){let l=e.selection;if(!(l instanceof M))return!1;if(t){let o=e.tr,n=f(e.schema).cell.createAndFill().content;l.forEachCell(((e,t)=>{e.content.eq(n)||o.replace(o.mapping.map(t+1),o.mapping.map(t+e.nodeSize-1),new r.p2(n,0,0))})),o.docChanged&&t(o)}return!0}function L(e,t){let l=w(e.state.doc.resolve(t));return!!l&&(e.dispatch(e.state.tr.setSelection(new M(l))),!0)}function Y(e,t,l){if(!g(e.state))return!1;let o=x(l),n=e.state.selection;if(n instanceof M){o||(o={width:1,height:1,rows:[r.HY.from(z(f(e.state.schema).cell,l))]});let t=n.$anchorCell.node(-1),i=n.$anchorCell.start(-1),a=p.get(t).rectBetween(n.$anchorCell.pos-i,n.$headCell.pos-i);return o=function({width:e,height:t,rows:l},o,n){if(e!=o){let t=[],n=[];for(let e=0;e<l.length;e++){let i=l[e],a=[];for(let l=t[e]||0,n=0;l<o;n++){let r=i.child(n%i.childCount);l+r.attrs.colspan>o&&(r=r.type.create(A(r.attrs,r.attrs.colspan,l+r.attrs.colspan-o),r.content)),a.push(r),l+=r.attrs.colspan;for(let l=1;l<r.attrs.rowspan;l++)t[e+l]=(t[e+l]||0)+r.attrs.colspan}n.push(r.HY.from(a))}l=n,e=o}if(t!=n){let e=[];for(let o=0,i=0;o<n;o++,i++){let a=[],s=l[i%t];for(let e=0;e<s.childCount;e++){let t=s.child(e);o+t.attrs.rowspan>n&&(t=t.type.create(S(t.attrs,"rowspan",Math.max(1,n-t.attrs.rowspan)),t.content)),a.push(t)}e.push(r.HY.from(a))}l=e,t=n}return{width:e,height:t,rows:l}}(o,a.right-a.left,a.bottom-a.top),E(e.state,e.dispatch,i,a,o),!0}if(o){let t=b(e.state),l=t.start(-1);return E(e.state,e.dispatch,l,p.get(t.node(-1)).findCell(t.pos-l),o),!0}return!1}function F(e,t){if(t.ctrlKey||t.metaKey)return;let l,o=I(e,t.target);if(t.shiftKey&&e.state.selection instanceof M)n(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&o&&null!=(l=w(e.state.selection.$anchor))&&P(e,t).pos!=l.pos)n(l,t),t.preventDefault();else if(!o)return;function n(t,l){let o=P(e,l),n=null==m.getState(e.state);if(!o||!y(t,o)){if(!n)return;o=t}let r=new M(t,o);if(n||!e.state.selection.eq(r)){let l=e.state.tr.setSelection(r);n&&l.setMeta(m,t.pos),e.dispatch(l)}}function r(){e.root.removeEventListener("mouseup",r),e.root.removeEventListener("dragstart",r),e.root.removeEventListener("mousemove",i),null!=m.getState(e.state)&&e.dispatch(e.state.tr.setMeta(m,-1))}function i(l){let i,a=m.getState(e.state);if(null!=a)i=e.state.doc.resolve(a);else if(I(e,l.target)!=o&&(i=P(e,t),!i))return r();i&&n(i,l)}e.root.addEventListener("mouseup",r),e.root.addEventListener("dragstart",r),e.root.addEventListener("mousemove",i)}function O(e,t,l){if(!(e.state.selection instanceof n.Bs))return null;let{$head:o}=e.state.selection;for(let n=o.depth-1;n>=0;n--){let r=o.node(n);if((l<0?o.index(n):o.indexAfter(n))!=(l<0?0:r.childCount))return null;if("cell"==r.type.spec.tableRole||"header_cell"==r.type.spec.tableRole){let r=o.before(n),i="vert"==t?l>0?"down":"up":l>0?"right":"left";return e.endOfTextblock(i)?r:null}}return null}function I(e,t){for(;t&&t!=e.dom;t=t.parentNode)if("TD"==t.nodeName||"TH"==t.nodeName)return t}function P(e,t){let l=e.posAtCoords({left:t.clientX,top:t.clientY});return l&&l?w(e.state.doc.resolve(l.pos)):null}const V=new n.H$("fix-tables");function X(e,t,l,o){let n=e.childCount,r=t.childCount;e:for(let i=0,a=0;i<r;i++){let r=t.child(i);for(let t=a,o=Math.min(n,i+3);t<o;t++)if(e.child(t)==r){a=t+1,l+=r.nodeSize;continue e}o(r,l),a<n&&e.child(a).sameMarkup(r)?X(e.child(a),r,l+1,o):r.nodesBetween(0,r.content.size,o,l+1),l+=r.nodeSize}}function K(e,t){let l,o=(t,o)=>{"table"==t.type.spec.tableRole&&(l=function(e,t,l,o){let n=p.get(t);if(!n.problems)return o;o||(o=e.tr);let r,i,a=[];for(let e=0;e<n.height;e++)a.push(0);for(let e=0;e<n.problems.length;e++){let r=n.problems[e];if("collision"==r.type){let e=t.nodeAt(r.pos);for(let t=0;t<e.attrs.rowspan;t++)a[r.row+t]+=r.n;o.setNodeMarkup(o.mapping.map(l+1+r.pos),null,A(e.attrs,e.attrs.colspan-r.n,r.n))}else if("missing"==r.type)a[r.row]+=r.n;else if("overlong_rowspan"==r.type){let e=t.nodeAt(r.pos);o.setNodeMarkup(o.mapping.map(l+1+r.pos),null,S(e.attrs,"rowspan",e.attrs.rowspan-r.n))}else if("colwidth mismatch"==r.type){let e=t.nodeAt(r.pos);o.setNodeMarkup(o.mapping.map(l+1+r.pos),null,S(e.attrs,"colwidth",r.colwidth))}}for(let e=0;e<a.length;e++)a[e]&&(null==r&&(r=e),i=e);for(let s=0,c=l+1;s<n.height;s++){let l=t.child(s),n=c+l.nodeSize,d=a[s];if(d>0){let t="cell";l.firstChild&&(t=l.firstChild.type.spec.tableRole);let a=[];for(let l=0;l<d;l++)a.push(f(e.schema)[t].createAndFill());let h=0!=s&&r!=s-1||i!=s?n-1:c+1;o.insert(o.mapping.map(h),a)}c=n}return o.setMeta(V,{fixTables:!0})}(e,t,o,l))};return t?t.doc!=e.doc&&X(t.doc,e.doc,0,o):e.doc.descendants(o),l}function q(e){let t,l=e.selection,o=b(e),n=o.node(-1),r=o.start(-1),i=p.get(n);return t=l instanceof M?i.rectBetween(l.$anchorCell.pos-r,l.$headCell.pos-r):i.findCell(o.pos-r),t.tableStart=r,t.map=i,t.table=n,t}function j(e,{map:t,tableStart:l,table:o},n){let r=n>0?-1:0;(function(e,t,l){let o=f(t.type.schema).header_cell;for(let n=0;n<e.height;n++)if(t.nodeAt(e.map[l+n*e.width]).type!=o)return!1;return!0})(t,o,n+r)&&(r=0==n||n==t.width?null:0);for(let i=0;i<t.height;i++){let a=i*t.width+n;if(n>0&&n<t.width&&t.map[a-1]==t.map[a]){let r=t.map[a],s=o.nodeAt(r);e.setNodeMarkup(e.mapping.map(l+r),null,$(s.attrs,n-t.colCount(r))),i+=s.attrs.rowspan-1}else{let s=null==r?f(o.type.schema).cell:o.nodeAt(t.map[a+r]).type,c=t.positionAt(i,n,o);e.insert(e.mapping.map(l+c),s.createAndFill())}}return e}function J(e,{map:t,table:l,tableStart:o},n){let r=e.mapping.maps.length;for(let i=0;i<t.height;){let a=i*t.width+n,s=t.map[a],c=l.nodeAt(s);if(n>0&&t.map[a-1]==s||n<t.width-1&&t.map[a+1]==s)e.setNodeMarkup(e.mapping.slice(r).map(o+s),null,A(c.attrs,n-t.colCount(s)));else{let t=e.mapping.slice(r).map(o+s);e.delete(t,t+c.nodeSize)}i+=c.attrs.rowspan}}function U(e,{map:t,tableStart:l,table:o},n){let r=l;for(let e=0;e<n;e++)r+=o.child(e).nodeSize;let i=[],a=n>0?-1:0;(function(e,t,l){let o=f(t.type.schema).header_cell;for(let n=0;n<e.width;n++)if(t.nodeAt(e.map[n+l*e.width]).type!=o)return!1;return!0})(t,o,n+a)&&(a=0==n||n==t.height?null:0);for(let r=0,s=t.width*n;r<t.width;r++,s++)if(n>0&&n<t.height&&t.map[s]==t.map[s-t.width]){let n=t.map[s],i=o.nodeAt(n).attrs;e.setNodeMarkup(l+n,null,S(i,"rowspan",i.rowspan+1)),r+=i.colspan-1}else{let e=null==a?f(o.type.schema).cell:o.nodeAt(t.map[s+a*t.width]).type;i.push(e.createAndFill())}return e.insert(r,f(o.type.schema).row.create(null,i)),e}function G(e,{map:t,table:l,tableStart:o},n){let r=0;for(let e=0;e<n;e++)r+=l.child(e).nodeSize;let i=r+l.child(n).nodeSize,a=e.mapping.maps.length;e.delete(r+o,i+o);for(let r=0,i=n*t.width;r<t.width;r++,i++){let s=t.map[i];if(n>0&&s==t.map[i-t.width]){let t=l.nodeAt(s).attrs;e.setNodeMarkup(e.mapping.slice(a).map(s+o),null,S(t,"rowspan",t.rowspan-1)),r+=t.colspan-1}else if(n<t.width&&s==t.map[i+t.width]){let i=l.nodeAt(s),c=i.type.create(S(i.attrs,"rowspan",i.attrs.rowspan-1),i.content),d=t.positionAt(n+1,r,l);e.insert(e.mapping.slice(a).map(o+d),c),r+=i.attrs.colspan-1}}}function Q(e){let t=e.content;return 1==t.childCount&&t.firstChild.isTextblock&&0==t.firstChild.childCount}function Z(e,t){let l=e.selection;if(!(l instanceof M)||l.$anchorCell.pos==l.$headCell.pos)return!1;let o=q(e),{map:n}=o;if(function({width:e,height:t,map:l},o){let n=o.top*e+o.left,r=n,i=(o.bottom-1)*e+o.left,a=n+(o.right-o.left-1);for(let t=o.top;t<o.bottom;t++){if(o.left>0&&l[r]==l[r-1]||o.right<e&&l[a]==l[a+1])return!0;r+=e,a+=e}for(let r=o.left;r<o.right;r++){if(o.top>0&&l[n]==l[n-e]||o.bottom<t&&l[i]==l[i+e])return!0;n++,i++}return!1}(n,o))return!1;if(t){let l,i,a=e.tr,s={},c=r.HY.empty;for(let e=o.top;e<o.bottom;e++)for(let t=o.left;t<o.right;t++){let r=n.map[e*n.width+t],d=o.table.nodeAt(r);if(!s[r])if(s[r]=!0,null==l)l=r,i=d;else{Q(d)||(c=c.append(d.content));let e=a.mapping.map(r+o.tableStart);a.delete(e,e+d.nodeSize)}}if(a.setNodeMarkup(l+o.tableStart,null,S($(i.attrs,i.attrs.colspan,o.right-o.left-i.attrs.colspan),"rowspan",o.bottom-o.top)),c.size){let e=l+1+i.content.size,t=Q(i)?l+1:e;a.replaceWith(t+o.tableStart,e+o.tableStart,c)}a.setSelection(new M(a.doc.resolve(l+o.tableStart))),t(a)}return!0}function ee(e,t){const l=f(e.schema);return(o=({node:e})=>l[e.type.spec.tableRole],(e,t)=>{let l,n,r=e.selection;if(r instanceof M){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;l=r.$anchorCell.nodeAfter,n=r.$anchorCell.pos}else{if(l=function(e){for(let t=e.depth;t>0;t--){const l=e.node(t).type.spec.tableRole;if("cell"===l||"header_cell"===l)return e.node(t)}return null}(r.$from),!l)return!1;n=w(r.$from).pos}if(1==l.attrs.colspan&&1==l.attrs.rowspan)return!1;if(t){let i=l.attrs,a=[],s=i.colwidth;i.rowspan>1&&(i=S(i,"rowspan",1)),i.colspan>1&&(i=S(i,"colspan",1));let c,d=q(e),h=e.tr;for(let e=0;e<d.right-d.left;e++)a.push(s?S(i,"colwidth",s&&s[e]?[s[e]]:null):i);for(let e=d.top;e<d.bottom;e++){let t=d.map.positionAt(e,d.left,d.table);e==d.top&&(t+=l.nodeSize);for(let n=d.left,r=0;n<d.right;n++,r++)n==d.left&&e==d.top||h.insert(c=h.mapping.map(t+d.tableStart,1),o({node:l,row:e,col:n}).createAndFill(a[r]))}h.setNodeMarkup(n,o({node:l,row:d.top,col:d.left}),a[0]),r instanceof M&&h.setSelection(new M(h.doc.resolve(r.$anchorCell.pos),c&&h.doc.resolve(c))),t(h)}return!0})(e,t);var o}function te(e,t,l){const o=t.map.cellsInRect({left:0,top:0,right:"row"==e?t.map.width:1,bottom:"column"==e?t.map.height:1});for(let e=0;e<o.length;e++){const n=t.table.nodeAt(o[e]);if(n&&n.type!==l.header_cell)return!1}return!0}function le(e,t){return(t=t||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(e){return function(t,l){if(!g(t))return!1;if(l){let o=f(t.schema),n=q(t),r=t.tr,i=n.map.cellsInRect("column"==e?new h(n.left,0,n.right,n.map.height):"row"==e?new h(0,n.top,n.map.width,n.bottom):n),a=i.map((e=>n.table.nodeAt(e)));for(let e=0;e<i.length;e++)a[e].type==o.header_cell&&r.setNodeMarkup(n.tableStart+i[e],o.cell,a[e].attrs);if(0==r.steps.length)for(let e=0;e<i.length;e++)r.setNodeMarkup(n.tableStart+i[e],o.header_cell,a[e].attrs);l(r)}return!0}}(e):function(t,l){if(!g(t))return!1;if(l){let o=f(t.schema),n=q(t),r=t.tr,i=te("row",n,o),a=te("column",n,o),s=("column"===e?i:"row"===e&&a)?1:0,c="column"==e?new h(0,s,1,n.map.height):"row"==e?new h(s,0,n.map.width,1):n,d="column"==e?a?o.cell:o.header_cell:"row"==e?i?o.cell:o.header_cell:o.cell;n.map.cellsInRect(c).forEach((e=>{const t=e+n.tableStart,l=r.doc.nodeAt(t);l&&r.setNodeMarkup(t,d,l.attrs)})),l(r)}return!0}}le("row",{useDeprecatedLogic:!0}),le("column",{useDeprecatedLogic:!0});let oe=le("cell",{useDeprecatedLogic:!0});function ne(e){return function(t,l){if(!g(t))return!1;let o=function(e,t){if(t<0){let t=e.nodeBefore;if(t)return e.pos-t.nodeSize;for(let t=e.index(-1)-1,l=e.before();t>=0;t--){let o=e.node(-1).child(t);if(o.childCount)return l-1-o.lastChild.nodeSize;l-=o.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;let t=e.node(-1);for(let l=e.indexAfter(-1),o=e.after();l<t.childCount;l++){let e=t.child(l);if(e.childCount)return o+1;o+=e.nodeSize}}}(b(t),e);if(null!=o){if(l){let e=t.doc.resolve(o);l(t.tr.setSelection(n.Bs.between(e,(r=e,r.node(0).resolve(r.pos+r.nodeAfter.nodeSize)))).scrollIntoView())}var r;return!0}}}class re{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ie(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type==this.node.type&&(this.node=e,ie(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return"attributes"==e.type&&(e.target==this.table||this.colgroup.contains(e.target))}}function ie(e,t,l,o,n,r){let i=0,a=!0,s=t.firstChild,c=e.firstChild;for(let e=0,l=0;e<c.childCount;e++){let{colspan:d,colwidth:h}=c.child(e).attrs;for(let e=0;e<d;e++,l++){let c=n==l?r:h&&h[e],d=c?c+"px":"";i+=c||o,c||(a=!1),s?(s.style.width!=d&&(s.style.width=d),s=s.nextSibling):t.appendChild(document.createElement("col")).style.width=d}}for(;s;){let e=s.nextSibling;s.parentNode.removeChild(s),s=e}a?(l.style.width=i+"px",l.style.minWidth=""):(l.style.width="",l.style.minWidth=i+"px")}const ae=new n.H$("tableColumnResizing");function se({handleWidth:e=5,cellMinWidth:t=25,View:l=re,lastColumnResizable:o=!0}={}){let r=new n.Sy({key:ae,state:{init(e,o){return this.spec.props.nodeViews[f(o.schema).table.name]=(e,o)=>new l(e,t,o),new ce(-1,!1)},apply(e,t){return t.apply(e)}},props:{attributes(e){return ae.getState(e).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove(t,l){!function(e,t,l,o,n){let r=ae.getState(e.state);if(!r.dragging){let o=function(e){for(;e&&"TD"!=e.nodeName&&"TH"!=e.nodeName;)e=e.classList.contains("ProseMirror")?null:e.parentNode;return e}(t.target),i=-1;if(o){let{left:n,right:r}=o.getBoundingClientRect();t.clientX-n<=l?i=de(e,t,"left"):r-t.clientX<=l&&(i=de(e,t,"right"))}if(i!=r.activeHandle){if(!n&&-1!==i){let t=e.state.doc.resolve(i),l=t.node(-1),o=p.get(l),n=t.start(-1);if(o.colCount(t.pos-n)+t.nodeAfter.attrs.colspan-1==o.width-1)return}pe(e,i)}}}(t,l,e,0,o)},mouseleave(e){!function(e){let t=ae.getState(e.state);t.activeHandle>-1&&!t.dragging&&pe(e,-1)}(e)},mousedown(e,l){!function(e,t,l){let o=ae.getState(e.state);if(-1==o.activeHandle||o.dragging)return!1;let n=e.state.doc.nodeAt(o.activeHandle),r=function(e,t,{colspan:l,colwidth:o}){let n=o&&o[o.length-1];if(n)return n;let r=e.domAtPos(t),i=r.node.childNodes[r.offset].offsetWidth,a=l;if(o)for(let e=0;e<l;e++)o[e]&&(i-=o[e],a--);return i/a}(e,o.activeHandle,n.attrs);function i(t){window.removeEventListener("mouseup",i),window.removeEventListener("mousemove",a);let o=ae.getState(e.state);o.dragging&&(!function(e,t,l){let o=e.state.doc.resolve(t),n=o.node(-1),r=p.get(n),i=o.start(-1),a=r.colCount(o.pos-i)+o.nodeAfter.attrs.colspan-1,s=e.state.tr;for(let e=0;e<r.height;e++){let t=e*r.width+a;if(e&&r.map[t]==r.map[t-r.width])continue;let o=r.map[t],{attrs:c}=n.nodeAt(o),d=1==c.colspan?0:a-r.colCount(o);if(c.colwidth&&c.colwidth[d]==l)continue;let h=c.colwidth?c.colwidth.slice():ue(c.colspan);h[d]=l,s.setNodeMarkup(i+o,null,S(c,"colwidth",h))}s.docChanged&&e.dispatch(s)}(e,o.activeHandle,he(o.dragging,t,l)),e.dispatch(e.state.tr.setMeta(ae,{setDragging:null})))}function a(t){if(!t.which)return i(t);let o=ae.getState(e.state),n=he(o.dragging,t,l);!function(e,t,l,o){let n=e.state.doc.resolve(t),r=n.node(-1),i=n.start(-1),a=p.get(r).colCount(n.pos-i)+n.nodeAfter.attrs.colspan-1,s=e.domAtPos(n.start(-1)).node;for(;"TABLE"!=s.nodeName;)s=s.parentNode;ie(r,s.firstChild,s,o,a,l)}(e,o.activeHandle,n,l)}e.dispatch(e.state.tr.setMeta(ae,{setDragging:{startX:t.clientX,startWidth:r}})),window.addEventListener("mouseup",i),window.addEventListener("mousemove",a),t.preventDefault()}(e,l,t)}},decorations(e){let t=ae.getState(e);if(t.activeHandle>-1)return function(e,t){let l=[],o=e.doc.resolve(t),n=o.node(-1),r=p.get(n),i=o.start(-1),s=r.colCount(o.pos-i)+o.nodeAfter.attrs.colspan;for(let e=0;e<r.height;e++){let t=s+e*r.width-1;if(!(s!=r.width&&r.map[t]==r.map[t+1]||0!=e&&r.map[t-1]==r.map[t-1-r.width])){let e=r.map[t],o=i+e+n.nodeAt(e).nodeSize-1,s=document.createElement("div");s.className="column-resize-handle",l.push(a.p.widget(o,s))}}return a.EH.create(e.doc,l)}(e,t.activeHandle)},nodeViews:{}}});return r}class ce{constructor(e,t){this.activeHandle=e,this.dragging=t}apply(e){let t=this,l=e.getMeta(ae);if(l&&null!=l.setHandle)return new ce(l.setHandle,null);if(l&&void 0!==l.setDragging)return new ce(t.activeHandle,l.setDragging);if(t.activeHandle>-1&&e.docChanged){let l=e.mapping.map(t.activeHandle,-1);C(e.doc.resolve(l))||(l=null),t=new ce(l,t.dragging)}return t}}function de(e,t,l){let o=e.posAtCoords({left:t.clientX,top:t.clientY});if(!o)return-1;let{pos:n}=o,r=w(e.state.doc.resolve(n));if(!r)return-1;if("right"==l)return r.pos;let i=p.get(r.node(-1)),a=r.start(-1),s=i.map.indexOf(r.pos-a);return s%i.width==0?-1:a+i.map[s-1]}function he(e,t,l){let o=t.clientX-e.startX;return Math.max(l,e.startWidth+o)}function pe(e,t){e.dispatch(e.state.tr.setMeta(ae,{setHandle:t}))}function ue(e){let t=[];for(let l=0;l<e;l++)t.push(0);return t}function fe({allowTableNodeSelection:e=!1}={}){return new n.Sy({key:m,state:{init(){return null},apply(e,t){let l=e.getMeta(m);if(null!=l)return-1==l?null:l;if(null==t||!e.docChanged)return t;let{deleted:o,pos:n}=e.mapping.mapResult(t);return o?null:n}},props:{decorations:N,handleDOMEvents:{mousedown:F},createSelectionBetween(e){if(null!=m.getState(e.state))return e.state.selection},handleTripleClick:L,handleKeyDown:T,handlePaste:Y},appendTransaction(t,l,o){return function(e,t,l){let o,r,i=(t||e).selection,a=(t||e).doc;if(i instanceof n.qv&&(r=i.node.type.spec.tableRole)){if("cell"==r||"header_cell"==r)o=M.create(a,i.from);else if("row"==r){let e=a.resolve(i.from+1);o=M.rowSelection(e,e)}else if(!l){let e=p.get(i.node),t=i.from+1,l=t+e.map[e.width*e.height-1];o=M.create(a,t+1,l)}}else i instanceof n.Bs&&function({$from:e,$to:t}){if(e.pos==t.pos||e.pos<e.pos-6)return!1;let l=e.pos,o=t.pos,n=e.depth;for(;n>=0&&!(e.after(n+1)<e.end(n));n--,l++);for(let e=t.depth;e>=0&&!(t.before(e+1)>t.start(e));e--,o--);return l==o&&/row|table/.test(e.node(n).type.spec.tableRole)}(i)?o=n.Bs.create(a,i.from):i instanceof n.Bs&&function({$from:e,$to:t}){let l,o;for(let t=e.depth;t>0;t--){let o=e.node(t);if("cell"===o.type.spec.tableRole||"header_cell"===o.type.spec.tableRole){l=o;break}}for(let e=t.depth;e>0;e--){let l=t.node(e);if("cell"===l.type.spec.tableRole||"header_cell"===l.type.spec.tableRole){o=l;break}}return l!==o&&0===t.parentOffset}(i)&&(o=n.Bs.create(a,i.$from.start(),i.$from.end()));return o&&(t||(t=e.tr)).setSelection(o),t}(o,K(o,l),e)}})}function me(e,t,l,o,n,r){let i=0,a=!0,s=t.firstChild;const c=e.firstChild;for(let e=0,l=0;e<c.childCount;e+=1){const{colspan:d,colwidth:h}=c.child(e).attrs;for(let e=0;e<d;e+=1,l+=1){const c=n===l?r:h&&h[e],d=c?`${c}px`:"";i+=c||o,c||(a=!1),s?(s.style.width!==d&&(s.style.width=d),s=s.nextSibling):t.appendChild(document.createElement("col")).style.width=d}}for(;s;){const e=s.nextSibling;s.parentNode.removeChild(s),s=e}a?(l.style.width=`${i}px`,l.style.minWidth=""):(l.style.width="",l.style.minWidth=`${i}px`)}class we{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),me(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type===this.node.type&&(this.node=e,me(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return"attributes"===e.type&&(e.target===this.table||this.colgroup.contains(e.target))}}function ge(e,t){return t?e.createChecked(null,t):e.createAndFill()}function be(e,t,l,o,n){const r=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach((l=>{const o=e.nodes[l];o.spec.tableRole&&(t[o.spec.tableRole]=o)})),e.cached.tableNodeTypes=t,t}(e),i=[],a=[];for(let e=0;e<l;e+=1){const e=ge(r.cell,n);if(e&&a.push(e),o){const e=ge(r.header_cell,n);e&&i.push(e)}}const s=[];for(let e=0;e<t;e+=1)s.push(r.row.createChecked(null,o&&0===e?i:a));return r.table.createChecked(null,s)}const Ce=({editor:e})=>{const{selection:t}=e.state;if(!(t instanceof M))return!1;let l=0;const n=(0,o.findParentNodeClosestToPos)(t.ranges[0].$from,(e=>"table"===e.type.name));null==n||n.node.descendants((e=>{if("table"===e.type.name)return!1;["tableCell","tableHeader"].includes(e.type.name)&&(l+=1)}));return l===t.ranges.length&&(e.commands.deleteTable(),!0)},ye=o.Node.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:we,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:e}){return["table",(0,o.mergeAttributes)(this.options.HTMLAttributes,e),["tbody",0]]},addCommands(){return{insertTable:({rows:e=3,cols:t=3,withHeaderRow:l=!0}={})=>({tr:o,dispatch:r,editor:i})=>{const a=be(i.schema,e,t,l);if(r){const e=o.selection.anchor+1;o.replaceSelectionWith(a).scrollIntoView().setSelection(n.Bs.near(o.doc.resolve(e)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>function(e,t){if(!g(e))return!1;if(t){let l=q(e);t(j(e.tr,l,l.left))}return!0}(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>function(e,t){if(!g(e))return!1;if(t){let l=q(e);t(j(e.tr,l,l.right))}return!0}(e,t),deleteColumn:()=>({state:e,dispatch:t})=>function(e,t){if(!g(e))return!1;if(t){let l=q(e),o=e.tr;if(0==l.left&&l.right==l.map.width)return!1;for(let e=l.right-1;J(o,l,e),e!=l.left;e--)l.table=l.tableStart?o.doc.nodeAt(l.tableStart-1):o.doc,l.map=p.get(l.table);t(o)}return!0}(e,t),addRowBefore:()=>({state:e,dispatch:t})=>function(e,t){if(!g(e))return!1;if(t){let l=q(e);t(U(e.tr,l,l.top))}return!0}(e,t),addRowAfter:()=>({state:e,dispatch:t})=>function(e,t){if(!g(e))return!1;if(t){let l=q(e);t(U(e.tr,l,l.bottom))}return!0}(e,t),deleteRow:()=>({state:e,dispatch:t})=>function(e,t){if(!g(e))return!1;if(t){let l=q(e),o=e.tr;if(0==l.top&&l.bottom==l.map.height)return!1;for(let e=l.bottom-1;G(o,l,e),e!=l.top;e--)l.table=l.tableStart?o.doc.nodeAt(l.tableStart-1):o.doc,l.map=p.get(l.table);t(o)}return!0}(e,t),deleteTable:()=>({state:e,dispatch:t})=>function(e,t){let l=e.selection.$anchor;for(let o=l.depth;o>0;o--)if("table"==l.node(o).type.spec.tableRole)return t&&t(e.tr.delete(l.before(o),l.after(o)).scrollIntoView()),!0;return!1}(e,t),mergeCells:()=>({state:e,dispatch:t})=>Z(e,t),splitCell:()=>({state:e,dispatch:t})=>ee(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>le("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>le("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>oe(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>!!Z(e,t)||ee(e,t),setCellAttribute:(e,t)=>({state:l,dispatch:o})=>function(e,t){return function(l,o){if(!g(l))return!1;let n=b(l);if(n.nodeAfter.attrs[e]===t)return!1;if(o){let r=l.tr;l.selection instanceof M?l.selection.forEachCell(((l,o)=>{l.attrs[e]!==t&&r.setNodeMarkup(o,null,S(l.attrs,e,t))})):r.setNodeMarkup(n.pos,null,S(n.nodeAfter.attrs,e,t)),o(r)}return!0}}(e,t)(l,o),goToNextCell:()=>({state:e,dispatch:t})=>ne(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>ne(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&K(e),!0),setCellSelection:e=>({tr:t,dispatch:l})=>{if(l){const l=M.create(t.doc,e.anchorCell,e.headCell);t.setSelection(l)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Ce,"Mod-Backspace":Ce,Delete:Ce,"Mod-Delete":Ce}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[se({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],fe({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:(0,o.callOrReturn)((0,o.getExtensionField)(e,"tableRole",t))}}})}}]);
//# sourceMappingURL=54327.7e615916640c5816c322.min.js.map